BX.namespace("BX.Sale.OrderAjaxComponent"),function(){"use strict";BX.Sale&&BX.Sale.Input&&BX.Sale.Input.Utils&&(BX.Sale.Input.Utils.asMultiple=function(a){if(void 0===a||null===a||""===a)return[];if(a.constructor===Array){for(var b,c=0,d=a.length;c<d;)b=a[c],void 0===b||null===b||""===b?(a.splice(c,1),--d):++c;return a.length?a:[""]}return[a]}),BX.Sale.OrderAjaxComponent={BXFormPosting:!1,regionBlockNotEmpty:!1,locationsInitialized:!1,locations:{},cleanLocations:{},locationsTemplate:"",pickUpMapInitialized:!1,basketColumns:[],options:{},activeSectionId:"",firstLoad:!0,initialized:{},mapsReady:!1,maxWaitTimeExpired:!1,lastSelectedDelivery:0,deliveryLocationInfo:{},deliveryPagination:{},deliveryCachedInfo:[],paySystemPagination:{},validation:{},hasErrorSection:{},pickUpPagination:{},timeOut:{},isMobile:BX.browser.IsMobile(),isHttps:"https:"==window.location.protocol,init:function(a){this.result=a.result||{},this.prepareLocations(a.locations),this.params=a.params||{},this.signedParamsString=a.signedParamsString||"",this.siteId=a.siteID||"",this.ajaxUrl=a.ajaxUrl||"",this.templateFolder=a.templateFolder||"",this.defaultBasketItemLogo=this.templateFolder+"/images/product_logo.png",this.defaultStoreLogo=this.templateFolder+"/images/pickup_logo.png",this.defaultDeliveryLogo=this.templateFolder+"/images/delivery_logo.png",this.defaultPaySystemLogo=this.templateFolder+"/images/pay_system_logo.png",this.orderBlockNode=BX(a.orderBlockId),this.totalBlockNode=BX(a.totalBlockId),this.mobileTotalBlockNode=BX(a.totalBlockId+"-mobile"),this.savedFilesBlockNode=BX("bx-soa-saved-files"),this.orderSaveBlockNode=BX("bx-soa-orderSave"),this.mainErrorsNode=BX("bx-soa-main-notifications"),this.authBlockNode=BX(a.authBlockId),this.authHiddenBlockNode=BX(a.authBlockId+"-hidden"),this.basketBlockNode=BX(a.basketBlockId),this.basketHiddenBlockNode=BX(a.basketBlockId+"-hidden"),this.regionBlockNode=BX(a.regionBlockId),this.regionHiddenBlockNode=BX(a.regionBlockId+"-hidden"),this.paySystemBlockNode=BX(a.paySystemBlockId),this.paySystemHiddenBlockNode=BX(a.paySystemBlockId+"-hidden"),this.deliveryBlockNode=BX(a.deliveryBlockId),this.deliveryHiddenBlockNode=BX(a.deliveryBlockId+"-hidden"),this.pickUpBlockNode=BX(a.pickUpBlockId),this.pickUpHiddenBlockNode=BX(a.pickUpBlockId+"-hidden"),this.propsBlockNode=BX(a.propsBlockId),this.propsHiddenBlockNode=BX(a.propsBlockId+"-hidden"),this.result.SHOW_AUTH&&(this.authBlockNode.style.display="",BX.addClass(this.authBlockNode,"bx-active"),this.authGenerateUser="Y"!=this.result.AUTH.new_user_registration_email_confirmation),this.totalBlockNode&&(this.totalInfoBlockNode=this.totalBlockNode.querySelector(".bx-soa-cart-total"),this.totalGhostBlockNode=this.totalBlockNode.querySelector(".bx-soa-cart-total-ghost")),this.options.deliveriesPerPage=parseInt(a.params.DELIVERIES_PER_PAGE),this.options.paySystemsPerPage=parseInt(a.params.PAY_SYSTEMS_PER_PAGE),this.options.pickUpsPerPage=parseInt(a.params.PICKUPS_PER_PAGE),this.options.showWarnings=!!a.showWarnings,this.options.propertyValidation=!!a.propertyValidation,this.options.priceDiffWithLastTime=!1,this.options.pickUpMap=a.pickUpMap,this.options.propertyMap=a.propertyMap,this.options.totalPriceChanged=!1,this.result.IS_AUTHORIZED&&!this.result.LAST_ORDER_DATA.FAIL||this.initFirstSection(),this.initOptions(),this.editOrder(),this.bindEvents(),this.orderBlockNode.removeAttribute("style"),this.basketBlockScrollCheck()},sendRequest:function(a,b){var c,d;(c=this.startLoader())&&(this.firstLoad=!1,a=BX.type.isString(a)?a:"refreshOrderAjax","saveOrderAjax"==a?(d=BX("bx-soa-order-form"),d&&(d.querySelector("input[type=hidden][name=sessid]").value=BX.bitrix_sessid()),BX.ajax.submit(BX("bx-soa-order-form"),BX.proxy(this.saveOrder,this))):BX.ajax({timeout:60,method:"POST",dataType:"json",url:this.ajaxUrl,data:this.getData(a,b),onsuccess:BX.proxy(function(b){switch(b.redirect&&b.redirect.length&&(document.location.href=b.redirect),this.saveFiles(),a){case"refreshOrderAjax":case"showAuthForm":this.refreshOrder(b);break;case"enterCoupon":b.order?(this.deliveryCachedInfo=[],this.refreshOrder(b)):this.addCoupon(b);break;case"removeCoupon":b.order?(this.deliveryCachedInfo=[],this.refreshOrder(b)):this.removeCoupon(b)}BX.cleanNode(this.savedFilesBlockNode),this.endLoader(c)},this),onfailure:BX.proxy(function(){this.endLoader(c)},this)}))},getData:function(a,b){var c={order:this.getAllFormData(),sessid:BX.bitrix_sessid(),via_ajax:"Y",SITE_ID:this.siteId,action:a,signedParamsString:this.signedParamsString};return"enterCoupon"!==a&&"removeCoupon"!==a||(c.coupon=b),c},getAllFormData:function(){var a,b=BX("bx-soa-order-form"),c=BX.ajax.prepareForm(b);for(a in c.data)c.data.hasOwnProperty(a)&&""==a&&delete c.data[a];return c&&c.data?c.data:{}},refreshOrder:function(a){if(a.error)this.showError(this.mainErrorsNode,a.error),this.animateScrollTo(this.mainErrorsNode,800,20);else if(a.order.SHOW_AUTH){var b=this.result.OK_MESSAGE&&this.result.OK_MESSAGE.length?"bx-step-good":"bx-step-bad";this.addAnimationEffect(this.authBlockNode,b),BX.merge(this.result,a.order),this.editAuthBlock(),this.showAuthBlock(),this.showErrors(a.order.ERROR,!1),this.animateScrollTo(this.authBlockNode)}else this.isPriceChanged(a),this.activeSectionId!==this.deliveryBlockNode.id&&(this.deliveryCachedInfo=[]),this.result=a.order,this.prepareLocations(a.locations),this.locationsInitialized=!1,this.maxWaitTimeExpired=!1,this.pickUpMapInitialized=!1,this.deliveryLocationInfo={},this.initialized={},this.initOptions(),this.editOrder(),this.mapsReady&&this.initMaps(),BX.saleOrderAjax&&BX.saleOrderAjax.initDeferredControl();return!0},saveOrder:function(a){var b=BX.parseJSON(a),c=!1;b&&b.order&&(a=b.order,this.result.SHOW_AUTH=a.SHOW_AUTH,this.result.AUTH=a.AUTH,this.result.SHOW_AUTH?(this.editAuthBlock(),this.showAuthBlock(),this.animateScrollTo(this.authBlockNode)):(a.REDIRECT_URL&&a.REDIRECT_URL.length&&(c=!0,document.location.href=a.REDIRECT_URL),this.showErrors(a.ERROR,!0))),c||this.endLoader()},startLoader:function(){return!0!==this.BXFormPosting&&(this.BXFormPosting=!0,this.loadingScreen||(this.loadingScreen=new BX.PopupWindow("loading_screen",null,{overlay:{backgroundColor:"white",opacity:"80"},events:{onAfterPopupShow:BX.proxy(function(){BX.cleanNode(this.loadingScreen.popupContainer),BX.removeClass(this.loadingScreen.popupContainer,"popup-window"),this.loadingScreen.popupContainer.appendChild(BX.create("IMG",{props:{src:this.templateFolder+"/images/preloader.png",width:"64",height:"64"}})),this.loadingScreen.popupContainer.removeAttribute("style"),this.loadingScreen.popupContainer.style.display="block"},this)}}),BX.addClass(this.loadingScreen.popupContainer,"bx-step-opacity")),setTimeout(BX.proxy(function(){this.loadingScreen.show()},this),100))},endLoader:function(a){this.BXFormPosting=!1,this.loadingScreen&&this.loadingScreen.isShown()&&this.loadingScreen.close(),clearTimeout(a)},saveFiles:function(){if(this.result.ORDER_PROP&&this.result.ORDER_PROP.properties){var a,b,c=this.result.ORDER_PROP.properties;for(a=0;a<c.length;a++)"FILE"==c[a].TYPE&&(b=this.orderBlockNode.querySelector('div[data-property-id-row="'+c[a].ID+'"]'))&&this.savedFilesBlockNode.appendChild(b)}},animateScrollTo:function(a,b,c){if(a){var d=BX.GetWindowScrollPos().scrollTop,e=BX.pos(this.orderBlockNode),f=BX.pos(a).top-(this.isMobile?50:0);c&&(f-=parseInt(c)),f+window.innerHeight>e.bottom&&(f=e.bottom-window.innerHeight+17),new BX.easing({duration:b||800,start:{scroll:d},finish:{scroll:f},transition:BX.easing.makeEaseOut(BX.easing.transitions.quad),step:BX.delegate(function(a){window.scrollTo(0,a.scroll)},this)}).animate()}},checkKeyPress:function(a){if(13==a.keyCode){var b,c,d=a.target||a.srcElement,e=d.getAttribute("data-send");if(!e)return b=d.getAttribute("data-next"),b&&(c=this.orderBlockNode.querySelector("input[name="+b+"]"))&&c.focus(),BX.PreventDefault(a)}},getSizeString:function(a,b){var c=1073741824,d=1048576,e=1024;return a=parseInt(a),b=parseInt(b),a>c?parseFloat(a/c).toFixed(b)+" Gb":a>d?parseFloat(a/d).toFixed(b)+" Mb":a>e?parseFloat(a/e).toFixed(b)+" Kb":a+" B"},getFileAccepts:function(a){var b,c,d=[],e=a.split(","),f={json:"application/json",javascript:"application/javascript","octet-stream":"application/octet-stream",ogg:"application/ogg",pdf:"application/pdf",zip:"application/zip",gzip:"application/gzip",aac:"audio/aac",mp3:"audio/mpeg",gif:"image/gif",jpeg:"image/jpeg",png:"image/png",svg:"image/svg+xml",tiff:"image/tiff",css:"text/css",csv:"text/csv",html:"text/html",plain:"text/plain",php:"text/php",xml:"text/xml",mpeg:"video/mpeg",mp4:"video/mp4",quicktime:"video/quicktime",flv:"video/x-flv",doc:"application/msword",docx:"application/msword",xls:"application/vnd.ms-excel",xlsx:"application/vnd.ms-excel"};for(b=0;b<e.length;b++)c=BX.util.trim(e[b]),c=f[c]||c,d.push(c);return d.join(",")},uniqueText:function(a,b){var c,d,e=[];for(a=a||"",b=b||"<br />",c=a.split(b),c=BX.util.array_unique(c),d=0;d<c.length;d++)""!=c[d]&&e.push(BX.util.trim(c[d]));return e.join(b)},getImageSources:function(a,b){return!!(a&&b&&a[b])&&{src_1x:a[b+"_SRC"],src_2x:a[b+"_SRC_2X"],src_orig:a[b+"_SRC_ORIGINAL"]}},getErrorContainer:function(a){a&&a.appendChild(BX.create("DIV",{props:{className:"alert alert-danger"},style:{display:"none"}}))},showError:function(a,b,c){BX.type.isArray(b)&&(b=b.join("<br />"));var d,e=a.querySelector(".alert.alert-danger");e&&b.length&&(BX.cleanNode(e),e.appendChild(BX.create("DIV",{html:b})),d=!this.hasErrorSection[a.id],d?(e.style.opacity=0,e.style.display="",new BX.easing({duration:300,start:{opacity:0},finish:{opacity:100},transition:BX.easing.makeEaseOut(BX.easing.transitions.quad),step:function(a){e.style.opacity=a.opacity/100},complete:function(){e.removeAttribute("style")}}).animate()):e.style.display="",c&&BX.addClass(a,"bx-step-error"))},showErrors:function(a,b){var c,d,e,f=this.orderBlockNode.querySelectorAll("div.alert.alert-danger");for(d=0;d<f.length;d++)c=BX.findParent(f[d],{className:"bx-soa-section"}),BX.removeClass(c,"bx-step-error"),f[d].style.display="none",BX.cleanNode(f[d]);if(a&&!(BX.util.object_keys(a).length<1)){for(d in a)if(a.hasOwnProperty(d))switch(e=a[d],d.toUpperCase()){case"MAIN":this.showError(this.mainErrorsNode,e),this.animateScrollTo(this.mainErrorsNode,800,20),b=!1;break;case"AUTH":"none"==this.authBlockNode.style.display?(this.showError(this.mainErrorsNode,e,!0),this.animateScrollTo(this.mainErrorsNode,800,20),b=!1):this.showError(this.authBlockNode,e,!0);break;case"REGION":this.showError(this.regionBlockNode,e,!0),this.showError(this.regionHiddenBlockNode,e);break;case"DELIVERY":this.showError(this.deliveryBlockNode,e,!0),this.showError(this.deliveryHiddenBlockNode,e);break;case"PAY_SYSTEM":this.showError(this.paySystemBlockNode,e,!0),this.showError(this.paySystemHiddenBlockNode,e);break;case"PROPERTY":this.showError(this.propsBlockNode,e,!0),this.showError(this.propsHiddenBlockNode,e)}!!b&&this.scrollToError()}},checkNotifications:function(){var a,b,c,d,e,f,g=this.mainErrorsNode.querySelector('[data-type="informer"]');g&&(this.firstLoad&&this.result.IS_AUTHORIZED&&!this.result.LAST_ORDER_DATA.FAIL?(b=this.orderBlockNode.querySelectorAll(".bx-soa-section.bx-active"),a=b.length&&"true"==b[b.length-1].getAttribute("data-visited"),c=a?"success":"warning",d=(a?this.params.MESS_SUCCESS_PRELOAD_TEXT:this.params.MESS_FAIL_PRELOAD_TEXT).split("#ORDER_BUTTON#").join(this.params.MESS_ORDER),g.appendChild(BX.create("DIV",{props:{className:"row"},children:[BX.create("DIV",{props:{className:"col-xs-12"},style:{position:"relative",paddingLeft:"48px"},children:[BX.create("DIV",{props:{className:"icon-"+c}}),BX.create("DIV",{html:d})]})]})),BX.addClass(g,"alert alert-"+c),g.style.display=""):BX.hasClass(g,"alert")&&(e=BX.GetWindowScrollPos().scrollTop,f=BX.pos(g),new BX.easing({duration:300,start:{opacity:100},finish:{opacity:0},transition:BX.easing.transitions.linear,step:function(a){g.style.opacity=a.opacity/100},complete:function(){e>f.top&&window.scrollBy(0,-(f.height+20)),g.style.display="none",BX.cleanNode(g),g.removeAttribute("class"),g.removeAttribute("style")}}).animate()))},checkPreload:function(a){var b;switch(a.id){case this.paySystemBlockNode.id:b=this.result.LAST_ORDER_DATA&&this.result.LAST_ORDER_DATA.PAY_SYSTEM;break;case this.deliveryBlockNode.id:b=this.result.LAST_ORDER_DATA&&this.result.LAST_ORDER_DATA.DELIVERY;break;case this.pickUpBlockNode.id:b=this.result.LAST_ORDER_DATA&&this.result.LAST_ORDER_DATA.PICK_UP;break;default:b=!0}return b},checkBlockErrors:function(a){var b,c,d,e,f,g;if((b=BX(a.id+"-hidden"))&&(c=b.querySelector("div.alert.alert-danger"),d=c&&"none"!=c.style.display,e=b.querySelector("div.alert.alert-warning.alert-show"),!d))for(f=b.querySelectorAll("div.tooltip"),g=0;g<f.length;g++)if("opened"==f[g].getAttribute("data-state")){d=!0;break}return d?BX.addClass(a,"bx-step-error"):e?BX.addClass(a,"bx-step-warning"):BX.removeClass(a,"bx-step-error bx-step-warning"),!d},scrollToError:function(){var a,b,c=this.orderBlockNode.querySelectorAll("div.bx-soa-section.bx-active");for(a in c)if(c.hasOwnProperty(a)&&(b=c[a].querySelector(".alert.alert-danger"))&&"none"!=b.style.display){this.animateScrollTo(c[a]);break}},showWarnings:function(){var a,b,c=this.orderBlockNode.querySelectorAll("div.bx-soa-section.bx-active"),d=this.getSelectedDelivery();for(a=0;a<c.length;a++)BX.removeClass(c[a],"bx-step-warning"),"false"==c[a].getAttribute("data-visited")&&BX.removeClass(c[a],"bx-step-completed");if(d&&d.CALCULATE_ERRORS?(BX.addClass(this.deliveryBlockNode,"bx-step-warning"),b="<strong>"+BX.util.htmlspecialchars(this.params.MESS_DELIVERY_CALC_ERROR_TITLE)+"</strong>",this.params.MESS_DELIVERY_CALC_ERROR_TEXT.length&&(b+="<br /><small>"+BX.util.htmlspecialchars(this.params.MESS_DELIVERY_CALC_ERROR_TEXT)+"</small>"),this.showBlockWarning(this.deliveryBlockNode,b),this.showBlockWarning(this.deliveryHiddenBlockNode,b),this.activeSectionId!=this.deliveryBlockNode.id&&(BX.addClass(this.deliveryBlockNode,"bx-step-completed"),BX.bind(this.deliveryBlockNode.querySelector(".alert.alert-warning"),"click",BX.proxy(this.showByClick,this)))):BX.hasClass(this.deliveryBlockNode,"bx-step-warning")&&this.activeSectionId!=this.deliveryBlockNode.id&&BX.removeClass(this.deliveryBlockNode,"bx-step-warning"),this.result.WARNING&&this.options.showWarnings)for(a in this.result.WARNING)if(this.result.WARNING.hasOwnProperty(a))switch(a.toUpperCase()){case"DELIVERY":this.showBlockWarning(this.deliveryBlockNode,this.result.WARNING[a],!0),this.showBlockWarning(this.deliveryHiddenBlockNode,this.result.WARNING[a],!0);break;case"PAY_SYSTEM":this.showBlockWarning(this.paySystemBlockNode,this.result.WARNING[a],!0),this.showBlockWarning(this.paySystemHiddenBlockNode,this.result.WARNING[a],!0)}},showBlockWarning:function(a,b,c){var d,e,f=a.querySelector(".alert.alert-danger"),g="";if(f){if(BX.type.isString(b))g=b;else for(d in b)b.hasOwnProperty(d)&&(g+=b[d]+"<br />");e=BX.create("DIV",{props:{className:"alert alert-warning"+(c?" alert-hide":" alert-show")},html:g}),BX.prepend(e,f.parentNode),BX.addClass(a,"bx-step-warning")}},showPagination:function(a,b){if(b&&a){var c,d,e,f,g,h,i=[];switch(a){case"delivery":c=this.deliveryPagination;break;case"paySystem":c=this.paySystemPagination;break;case"pickUp":c=this.pickUpPagination}if(c.pages.length>1){for(i.push(BX.create("LI",{attrs:{"data-action":"prev","data-entity":a},props:{className:"bx-pag-prev"},html:1==c.pageNumber?"<span>"+BX.util.htmlspecialchars(this.params.MESS_NAV_BACK)+"</span>":'<a href=""><span>'+BX.util.htmlspecialchars(this.params.MESS_NAV_BACK)+"</span></a>",events:{click:BX.proxy(this.doPagination,this)}})),d=0;d<c.pages.length;d++)e=parseInt(d)+1,f=e==c.pageNumber?"bx-active":"",i.push(BX.create("LI",{attrs:{"data-action":e,"data-entity":a},props:{className:f},html:'<a href=""><span>'+e+"</span></a>",events:{click:BX.proxy(this.doPagination,this)}}));i.push(BX.create("LI",{attrs:{"data-action":"next","data-entity":a},props:{className:"bx-pag-next"},html:c.pageNumber==c.pages.length?"<span>"+BX.util.htmlspecialchars(this.params.MESS_NAV_FORWARD)+"</span>":'<a href=""><span>'+BX.util.htmlspecialchars(this.params.MESS_NAV_FORWARD)+"</span></a>",events:{click:BX.proxy(this.doPagination,this)}})),g=this.params.TEMPLATE_THEME||"",h=BX.create("DIV",{props:{className:"bx-pagination"+(g?" bx-"+g:"")},children:[BX.create("DIV",{props:{className:"bx-pagination-container"},children:[BX.create("UL",{children:i})]})]}),b.appendChild(BX.create("DIV",{style:{clear:"both"}})),b.appendChild(h)}}},doPagination:function(a){var b,c=a.target||a.srcElement,d="LI"==c.tagName?c:BX.findParent(c,{tagName:"LI"}),e=d.getAttribute("data-action"),f=d.getAttribute("data-entity");return BX.hasClass(d,"bx-active")?BX.PreventDefault(a):("prev"!=e&&"next"!=e||(b=parseInt(BX.findParent(d).querySelector(".bx-active").getAttribute("data-action")),e="next"==e?++b:--b),"delivery"==f?this.showDeliveryItemsPage(e):"paySystem"==f?this.showPaySystemItemsPage(e):"pickUp"==f&&this.showPickUpItemsPage(e),BX.PreventDefault(a))},showDeliveryItemsPage:function(a){this.getCurrentPageItems("delivery",a);var b,c,d,e,f=this.getSelectedDelivery();for(f&&f.ID&&((b=this.deliveryBlockNode.querySelector("input[type=hidden][name=DELIVERY_ID]"))||(b=BX.create("INPUT",{props:{type:"hidden",name:"DELIVERY_ID",value:f.ID}}))),c=this.deliveryBlockNode.querySelector(".bx-soa-pp-item-container"),BX.cleanNode(c),BX.type.isDomNode(b)&&BX.prepend(b,BX.findParent(c)),d=0;d<this.deliveryPagination.currentPage.length;d++)e=this.createDeliveryItem(this.deliveryPagination.currentPage[d]),c.appendChild(e);this.showPagination("delivery",c)},showPaySystemItemsPage:function(a){this.getCurrentPageItems("paySystem",a);var b,c,d,e,f=this.getSelectedPaySystem();for(f&&f.ID&&((b=this.paySystemBlockNode.querySelector("input[type=hidden][name=PAY_SYSTEM_ID]"))||(b=BX.create("INPUT",{props:{type:"hidden",name:"PAY_SYSTEM_ID",value:f.ID}}))),c=this.paySystemBlockNode.querySelector(".bx-soa-pp-item-container"),BX.cleanNode(c),BX.type.isDomNode(b)&&BX.prepend(b,BX.findParent(c)),d=0;d<this.paySystemPagination.currentPage.length;d++)e=this.createPaySystemItem(this.paySystemPagination.currentPage[d]),c.appendChild(e);this.showPagination("paySystem",c)},showPickUpItemsPage:function(a){this.getCurrentPageItems("pickUp",a),this.editPickUpList(!1)},getCurrentPageItems:function(a,b){if(a&&void 0!==b){var c,d;switch(a){case"delivery":c=this.deliveryPagination,d=this.options.deliveriesPerPage;break;case"paySystem":c=this.paySystemPagination,d=this.options.paySystemsPerPage;break;case"pickUp":c=this.pickUpPagination,d=this.options.pickUpsPerPage}if(c&&d>0){if(b<=0||b>c.pages.length)return;c.pageNumber=b,c.currentPage=c.pages.slice(c.pageNumber-1,c.pageNumber)[0]}}},initPropsListForLocation:function(){if(BX.saleOrderAjax&&this.result.ORDER_PROP&&this.result.ORDER_PROP.properties){var a,b,c,d;for(BX.saleOrderAjax.cleanUp(),a=0;a<this.result.ORDER_PROP.properties.length;a++)if(c=this.result.ORDER_PROP.properties[a],"LOCATION"==c.TYPE&&"Y"==c.MULTIPLE&&"Y"!=c.IS_LOCATION)for(b=0;b<this.locations[c.ID].length;b++)BX.saleOrderAjax.addPropertyDesc({id:c.ID+"_"+b,attributes:{id:c.ID+"_"+b,type:c.TYPE,valueSource:"DEFAULT"==c.SOURCE?"default":"form"}});else d={id:c.ID,type:c.TYPE,valueSource:"DEFAULT"==c.SOURCE?"default":"form"},parseInt(c.INPUT_FIELD_LOCATION)>0&&(d.altLocationPropId=parseInt(c.INPUT_FIELD_LOCATION),this.deliveryLocationInfo.city=c.INPUT_FIELD_LOCATION),"Y"==c.IS_LOCATION&&(this.deliveryLocationInfo.loc=c.ID),"Y"==c.IS_ZIP&&(d.isZip=!0,this.deliveryLocationInfo.zip=c.ID),BX.saleOrderAjax.addPropertyDesc({id:c.ID,attributes:d})}},bindEvents:function(){BX.bind(this.orderSaveBlockNode.querySelector("a"),"click",BX.proxy(this.clickOrderSaveAction,this)),BX.bind(window,"scroll",BX.proxy(this.totalBlockScrollCheck,this)),BX.bind(window,"resize",BX.throttle(function(){this.totalBlockResizeCheck(),this.alignBasketColumns(),this.basketBlockScrollCheck(),this.mapsReady&&this.resizeMapContainers()},50,this)),BX.addCustomEvent("onDeliveryExtraServiceValueChange",BX.proxy(this.sendRequest,this))},initFirstSection:function(){var a=this.orderBlockNode.querySelector(".bx-soa-section.bx-active");BX.addClass(a,"bx-selected"),this.activeSectionId=a.id},initOptions:function(){var a,b,c;if(this.initPropsListForLocation(),this.propertyCollection=new BX.Sale.PropertyCollection(BX.merge({publicMode:!0},this.result.ORDER_PROP)),this.fadedPropertyCollection=new BX.Sale.PropertyCollection(BX.merge({publicMode:!0},this.result.ORDER_PROP)),this.options.propertyValidation&&this.initValidation(),this.initPagination(),this.result.GRID&&this.result.GRID.HEADERS)for(a=this.result.GRID.HEADERS,b=0;b<a.length;b++)"PREVIEW_PICTURE"==a[b].id&&(this.options.showPreviewPicInBasket=!0),"DETAIL_PICTURE"==a[b].id&&(this.options.showDetailPicInBasket=!0),"PROPS"==a[b].id&&(this.options.showPropsInBasket=!0),"NOTES"==a[b].id&&(this.options.showPriceNotesInBasket=!0);this.result.TOTAL&&(c=this.result.TOTAL,this.options.showOrderWeight=c.ORDER_WEIGHT&&parseFloat(c.ORDER_WEIGHT)>0,this.options.showPriceWithoutDiscount=parseFloat(c.ORDER_PRICE)<parseFloat(c.PRICE_WITHOUT_DISCOUNT_VALUE),this.options.showDiscountPrice=c.DISCOUNT_PRICE&&parseFloat(c.DISCOUNT_PRICE)>0,this.options.showTaxList=c.TAX_LIST&&c.TAX_LIST.length,this.options.showPayedFromInnerBudget=c.PAYED_FROM_ACCOUNT_FORMATED&&c.PAYED_FROM_ACCOUNT_FORMATED.length)},reachGoal:function(a,b){var c,d=this.params.YM_GOALS_COUNTER||"",e="Y"==this.params.USE_YM_GOALS&&void 0!==window["yaCounter"+d];e&&(c=this.getGoalId(a,b),window["yaCounter"+d].reachGoal(c))},getGoalId:function(a,b){if(!a)return"";if("initialization"==a)return this.params.YM_GOALS_INITIALIZE;if("order"==a)return this.params.YM_GOALS_SAVE_ORDER;var c="",d="edit"==a;if(!b||!b.id)return"";switch(b.id){case this.basketBlockNode.id:c=d?this.params.YM_GOALS_EDIT_BASKET:this.params.YM_GOALS_NEXT_BASKET;break;case this.regionBlockNode.id:c=d?this.params.YM_GOALS_EDIT_REGION:this.params.YM_GOALS_NEXT_REGION;break;case this.paySystemBlockNode.id:c=d?this.params.YM_GOALS_EDIT_PAY_SYSTEM:this.params.YM_GOALS_NEXT_PAY_SYSTEM;break;case this.deliveryBlockNode.id:c=d?this.params.YM_GOALS_EDIT_DELIVERY:this.params.YM_GOALS_NEXT_DELIVERY;break;case this.pickUpBlockNode.id:c=d?this.params.YM_GOALS_EDIT_PICKUP:this.params.YM_GOALS_NEXT_PICKUP;break;case this.propsBlockNode.id:c=d?this.params.YM_GOALS_EDIT_PROPERTIES:this.params.YM_GOALS_NEXT_PROPERTIES}return c},isPriceChanged:function(a){var b=null===this.result.TOTAL.ORDER_TOTAL_LEFT_TO_PAY||""===this.result.TOTAL.ORDER_TOTAL_LEFT_TO_PAY?this.result.TOTAL.ORDER_TOTAL_PRICE:this.result.TOTAL.ORDER_TOTAL_LEFT_TO_PAY,c=null===a.order.TOTAL.ORDER_TOTAL_LEFT_TO_PAY?a.order.TOTAL.ORDER_TOTAL_PRICE:a.order.TOTAL.ORDER_TOTAL_LEFT_TO_PAY;this.options.totalPriceChanged=parseFloat(b)!=parseFloat(c)},initValidation:function(){if(this.result.ORDER_PROP&&this.result.ORDER_PROP.properties){var a,b=this.result.ORDER_PROP.properties,c={};for(a in b)b.hasOwnProperty(a)&&(c[b[a].ID]=b[a]);this.validation.properties=c}},initPagination:function(){var a,b,c,d;if(this.result.DELIVERY)if(this.result.DELIVERY=this.getDeliverySortedArray(this.result.DELIVERY),this.options.deliveriesPerPage>0&&this.result.DELIVERY.length>this.options.deliveriesPerPage){for(a=this.result.DELIVERY.slice(),b=Math.ceil(a.length/this.options.deliveriesPerPage),c=[],d=0;d<b;d++)c.push(a.splice(0,this.options.deliveriesPerPage));for(this.deliveryPagination.pages=c,d=0;d<this.result.DELIVERY.length;d++)if("Y"==this.result.DELIVERY[d].CHECKED){this.deliveryPagination.pageNumber=Math.ceil(++d/this.options.deliveriesPerPage);break}this.deliveryPagination.pageNumber=this.deliveryPagination.pageNumber||1,this.deliveryPagination.currentPage=c.slice(this.deliveryPagination.pageNumber-1,this.deliveryPagination.pageNumber)[0],this.deliveryPagination.show=!0}else this.deliveryPagination.pageNumber=1,this.deliveryPagination.currentPage=this.result.DELIVERY,this.deliveryPagination.show=!1;if(this.result.PAY_SYSTEM)if(this.options.paySystemsPerPage>0&&this.result.PAY_SYSTEM.length>this.options.paySystemsPerPage){for(a=this.result.PAY_SYSTEM.slice(),b=Math.ceil(a.length/this.options.paySystemsPerPage),c=[],d=0;d<b;d++)c.push(a.splice(0,this.options.paySystemsPerPage));for(this.paySystemPagination.pages=c,d=0;d<this.result.PAY_SYSTEM.length;d++)if("Y"==this.result.PAY_SYSTEM[d].CHECKED){this.paySystemPagination.pageNumber=Math.ceil(++d/this.options.paySystemsPerPage);break}this.paySystemPagination.pageNumber=this.paySystemPagination.pageNumber||1,this.paySystemPagination.currentPage=c.slice(this.paySystemPagination.pageNumber-1,this.paySystemPagination.pageNumber)[0],this.paySystemPagination.show=!0}else this.paySystemPagination.pageNumber=1,this.paySystemPagination.currentPage=this.result.PAY_SYSTEM,this.paySystemPagination.show=!1},initPickUpPagination:function(){var a,b,c,d,e=!1,f=!1,g=0;if(this.options.pickUpsPerPage>=0&&this.result.DELIVERY)for(g=0;g<this.result.DELIVERY.length;g++)if("Y"==this.result.DELIVERY[g].CHECKED){f=this.result.DELIVERY[g].STORE_MAIN.length>0,e=this.result.DELIVERY[g].STORE_MAIN.length>this.options.pickUpsPerPage,f&&(a=this.getPickUpInfoArray(this.result.DELIVERY[g].STORE_MAIN));break}if(f)if(this.options.pickUpsPerPage>0&&e){for(b=a.slice(),c=Math.ceil(b.length/this.options.pickUpsPerPage),d=[],g=0;g<c;g++)d.push(b.splice(0,this.options.pickUpsPerPage));for(this.pickUpPagination.pages=d,g=0;g<a.length;g++)if(!this.result.BUYER_STORE||a[g].ID==this.result.BUYER_STORE){this.pickUpPagination.pageNumber=Math.ceil(++g/this.options.pickUpsPerPage);break}this.pickUpPagination.pageNumber||(this.pickUpPagination.pageNumber=1),this.pickUpPagination.currentPage=d.slice(this.pickUpPagination.pageNumber-1,this.pickUpPagination.pageNumber)[0],this.pickUpPagination.show=!0}else this.pickUpPagination.pageNumber=1,this.pickUpPagination.currentPage=a,this.pickUpPagination.show=!1},prepareLocations:function(a){this.locations={},this.cleanLocations={};var b,c,d,e;if(BX.util.object_keys(a).length)for(c in a)if(a.hasOwnProperty(c)){this.locationsTemplate=a[c].template||"",b=[],e=a[c].output,e.clean&&(this.cleanLocations[c]=BX.processHTML(e.clean,!1),delete e.clean);for(d in e)e.hasOwnProperty(d)&&b.push({output:BX.processHTML(e[d],!1),showAlt:a[c].showAlt});this.locations[c]=b}},locationsCompletion:function(){var a,b,c,d,e,f,g,h;this.locationsInitialized=!0,this.fixLocationsStyle(this.regionBlockNode,this.regionHiddenBlockNode),this.fixLocationsStyle(this.propsBlockNode,this.propsHiddenBlockNode);for(a in this.locations)this.locations.hasOwnProperty(a)&&(b=this.orderBlockNode.querySelector('div[data-property-id-row="'+a+'"]'))&&(c=b.querySelector("div.bx-ui-sls-clear"),d=b.querySelector("div.bx-ui-slst-pool"),e=b.querySelector("input.bx-ui-sls-fake[type=text]"),b.removeAttribute("style"),this.bindValidation(a,b),c&&BX.bind(c,"click",function(a){var b,c=a.target||a.srcElement,d=BX.findParent(c,{tagName:"DIV",className:"form-group"});d&&(b=d.querySelector("input.bx-ui-sls-fake[type=text]")),b&&BX.fireEvent(b,"keyup")}),!this.firstLoad&&this.options.propertyValidation&&(d&&(f=this.validation.properties[a],g=this.getValidationData(f,b),(h=BX.findParent(b,{className:"bx-soa-section"}))&&"true"==h.getAttribute("data-visited")&&this.isValidProperty(g)),e&&BX.fireEvent(e,"keyup")));this.firstLoad&&this.result.IS_AUTHORIZED&&!this.result.LAST_ORDER_DATA.FAIL&&this.showActualBlock(),this.checkNotifications(),this.activeSectionId!==this.regionBlockNode.id&&this.editFadeRegionContent(this.regionBlockNode.querySelector(".bx-soa-section-content")),this.activeSectionId!=this.propsBlockNode.id&&this.editFadePropsContent(this.propsBlockNode.querySelector(".bx-soa-section-content"))},fixLocationsStyle:function(a,b){if(a&&b){var c,d,e,f=this.activeSectionId==a.id?a:b;if(c=f.querySelectorAll("div.bx-sls div.dropdown-block.bx-ui-sls-input-block"),d=f.querySelectorAll("div.bx-slst div.dropdown-block.bx-ui-slst-input-block"),c.length)for(e=0;e<c.length;e++)BX.addClass(c[e],"form-control");if(d.length)for(e=0;e<d.length;e++)BX.addClass(d[e],"form-control")}},clickOrderSaveAction:function(a){return this.reachGoal("order"),this.isValidForm()&&this.sendRequest("saveOrderAjax"),BX.PreventDefault(a)},clickNextAction:function(a){var b,c,d,e=a.target||a.srcElement,f=BX.findParent(e,{className:"bx-active"}),g=this.getNextSection(f);return this.reachGoal("next",f),this.result.IS_AUTHORIZED||"false"!=g.next.getAttribute("data-visited")||(c=g.next.querySelector(".bx-soa-section-title-container"),BX.bind(c,"click",BX.proxy(this.showByClick,this)),d=g.next.querySelector(".bx-soa-editstep"),d&&(d.style.display=""),b=this.orderBlockNode.querySelectorAll(".bx-soa-section.bx-active"),g.next.id==b[b.length-1].id&&this.switchOrderSaveButtons(!0)),this.fade(f,g.next),this.show(g.next),BX.PreventDefault(a)},clickPrevAction:function(a){var b=a.target||a.srcElement,c=BX.findParent(b,{className:"bx-active"}),d=this.getPrevSection(c);return this.fade(c),this.show(d.next),this.animateScrollTo(d.next,500),BX.PreventDefault(a)},showAuthBlock:function(){var a=this.authBlockNode,b=BX(this.activeSectionId);a&&!BX.hasClass(a,"bx-selected")&&(this.show(a),b&&this.fade(b))},closeAuthBlock:function(){var a=this.authBlockNode,b=this.getNextSection(a).next;this.fade(a),BX.cleanNode(BX(b.id+"-hidden")),this.show(b)},getNextSection:function(a,b){if(!this.orderBlockNode||!a)return{};var c,d,e,f,g,h,i,j=this.orderBlockNode.querySelectorAll(".bx-soa-section.bx-active");for(d=0;d<j.length;d++)if(j[d].id==a.id&&j[d+1])return c=j[d+1],e=!1,f=!1,g=!1,"Y"==this.params.SKIP_USELESS_BLOCK&&(c.id==this.pickUpBlockNode.id&&(h=this.getSelectedDelivery())&&(e=1==this.getPickUpInfoArray(h.STORE).length),c.id==this.deliveryBlockNode.id&&(f=this.result.DELIVERY&&1==this.result.DELIVERY.length&&0===this.result.DELIVERY[0].EXTRA_SERVICES.length&&!this.result.DELIVERY[0].CALCULATE_ERRORS),c.id==this.paySystemBlockNode.id&&(g=this.result.PAY_SYSTEM&&1==this.result.PAY_SYSTEM.length&&"Y"!=this.result.PAY_FROM_ACCOUNT),e||f||g)?(this.result.IS_AUTHORIZED||"false"!=c.getAttribute("data-visited")||(this.changeVisibleSection(c,!0),i=c.querySelector(".bx-soa-section-title-container"),BX.bind(i,"click",BX.proxy(this.showByClick,this))),c.setAttribute("data-visited","true"),BX.addClass(c,"bx-step-completed"),this.getNextSection(c,c)):{prev:a,next:c,skip:b}},getPrevSection:function(a){if(this.orderBlockNode&&a){var b,c,d,e,f=this.orderBlockNode.querySelectorAll(".bx-soa-section.bx-active");for(c=0;c<f.length;c++)if(f[c].id==a.id&&f[c-1])return d=!1,b=f[c-1],b.id==this.pickUpBlockNode.id&&(e=this.getSelectedDelivery())&&(d=1==this.getPickUpInfoArray(e.STORE).length),b.id==this.deliveryBlockNode.id&&1==this.result.DELIVERY.length&&0===this.result.DELIVERY[0].EXTRA_SERVICES.length&&!this.result.DELIVERY[0].CALCULATE_ERRORS||b.id==this.paySystemBlockNode.id&&1==this.result.PAY_SYSTEM.length&&"Y"!=this.result.PAY_FROM_ACCOUNT||b.id==this.pickUpBlockNode.id&&d?(b.setAttribute("data-visited","true"),BX.addClass(b,"bx-step-completed"),this.getPrevSection(b)):{prev:a,next:b}}},addAnimationEffect:function(a,b,c){a&&b&&(this.timeOut[a.id]&&(clearTimeout(this.timeOut[a.id].timer),BX.removeClass(a,this.timeOut[a.id].className)),setTimeout(function(){BX.addClass(a,b)},10),this.timeOut[a.id]={className:b,timer:setTimeout(BX.proxy(function(){BX.removeClass(a,b),delete this.timeOut[a.id]},this),c||5e3)})},fade:function(a,b){if(a&&a.id){this.hasErrorSection[a.id]=!1;var c,d=a.offsetHeight;switch(a.id){case this.authBlockNode.id:this.authBlockNode.style.display="none",BX.removeClass(this.authBlockNode,"bx-active");break;case this.basketBlockNode.id:this.editFadeBasketBlock();break;case this.regionBlockNode.id:this.editFadeRegionBlock();break;case this.paySystemBlockNode.id:BX.remove(this.paySystemBlockNode.querySelector(".alert.alert-warning.alert-hide")),
this.editFadePaySystemBlock();break;case this.deliveryBlockNode.id:BX.remove(this.deliveryBlockNode.querySelector(".alert.alert-warning.alert-hide")),this.editFadeDeliveryBlock();break;case this.pickUpBlockNode.id:this.editFadePickUpBlock();break;case this.propsBlockNode.id:this.editFadePropsBlock()}if(BX.addClass(a,"bx-step-completed"),BX.removeClass(a,"bx-selected"),c=a.offsetHeight,a.style.height=d+"px",b){var e,f,g,h,i,j,k=BX.GetWindowScrollPos().scrollTop,l=BX.pos(this.orderBlockNode),m=BX.pos(a);i=BX(b.id+"-hidden"),i.style.left="-10000",i.style.position="absolute",this.orderBlockNode.appendChild(i),g=b.offsetHeight,h=i.offsetHeight+57,BX(a.id+"-hidden").parentNode.appendChild(i),i.removeAttribute("style"),e=c+h-d-g,j=window.innerHeight-l.height-e,j>0?f=l.top-j/2:(f=m.top>k?m.top:m.bottom+6-d+c)+window.innerHeight>l.bottom+25+e&&(f=l.bottom+25+e-window.innerHeight),f-=this.isMobile?50:0}new BX.easing({duration:b?1e3:600,start:{height:d,scrollTop:k},finish:{height:c,scrollTop:f},transition:BX.easing.makeEaseOut(BX.easing.transitions.quad),step:function(c){a.style.height=c.height+"px",b&&window.scrollTo(0,c.scrollTop)},complete:function(){a.style.height=""}}).animate(),this.checkBlockErrors(a)}},show:function(a){if(a&&a.id&&this.activeSectionId!=a.id){switch(this.activeSectionId=a.id,BX.removeClass(a,"bx-step-error bx-step-warning"),a.id){case this.authBlockNode.id:this.authBlockNode.style.display="",BX.addClass(this.authBlockNode,"bx-active");break;case this.basketBlockNode.id:this.editActiveBasketBlock(!0),this.alignBasketColumns();break;case this.regionBlockNode.id:this.editActiveRegionBlock(!0);break;case this.deliveryBlockNode.id:this.editActiveDeliveryBlock(!0);break;case this.paySystemBlockNode.id:this.editActivePaySystemBlock(!0);break;case this.pickUpBlockNode.id:this.editActivePickUpBlock(!0);break;case this.propsBlockNode.id:this.editActivePropsBlock(!0)}a.setAttribute("data-visited","true"),BX.addClass(a,"bx-selected"),BX.removeClass(a,"bx-step-completed")}},showByClick:function(a){var b=a.target||a.srcElement,c=BX.findParent(b,{className:"bx-active"}),d=BX(this.activeSectionId),e=BX.GetWindowScrollPos().scrollTop;return!c||BX.hasClass(c,"bx-selected")?BX.PreventDefault(a):(this.reachGoal("edit",c),this.show(c),d&&this.fade(d),setTimeout(BX.proxy(function(){BX.pos(c).top<e&&this.animateScrollTo(c,300)},this),320),BX.PreventDefault(a))},showActualBlock:function(){for(var a=this.orderBlockNode.querySelectorAll(".bx-soa-section.bx-active"),b=0;a[b];){if(a[b].id==this.regionBlockNode.id&&this.isValidRegionBlock(),a[b].id==this.propsBlockNode.id&&this.isValidPropertiesBlock(),!this.checkBlockErrors(a[b])||!this.checkPreload(a[b])){this.show(a[b]);break}BX.addClass(a[b],"bx-step-completed"),a[b].setAttribute("data-visited","true"),b++}},getBlockFooter:function(a){var b=this.orderBlockNode.querySelectorAll(".bx-soa-section.bx-active"),c=b[0],d=b[b.length-1],e=BX.findParent(a,{className:"bx-soa-section"}),f=!1,g=[];e&&"-1"==e.id.indexOf(c.id)&&g.push(BX.create("A",{props:{href:"",className:"pull-left btn btn-default btn-md"},text:this.params.MESS_BACK,events:{click:BX.proxy(this.clickPrevAction,this)}})),e&&"-1"!=e.id.indexOf(d.id)&&(f=!0),f||g.push(BX.create("A",{props:{href:"",className:"pull-right btn btn-default btn-md"},text:this.params.MESS_FURTHER,events:{click:BX.proxy(this.clickNextAction,this)}})),a.appendChild(BX.create("DIV",{props:{className:"row bx-soa-more"},children:[BX.create("DIV",{props:{className:"bx-soa-more-btn col-xs-12"},children:g})]}))},getNewContainer:function(a){return BX.create("DIV",{props:{className:"bx-soa-section-content"+(a?"":" container-fluid")}})},switchOrderSaveButtons:function(a){var b=this.orderSaveBlockNode,c=this.totalBlockNode.querySelector(".bx-soa-cart-total-button-container"),d=this.mobileTotalBlockNode.querySelector(".bx-soa-cart-total-button-container");""==this.orderSaveBlockNode.style.display!=a&&(a?(b.style.opacity=0,b.style.display="",c&&(c.style.opacity=0,c.style.display=""),d&&(d.style.opacity=0,d.style.display=""),new BX.easing({duration:500,start:{opacity:0},finish:{opacity:100},transition:BX.easing.transitions.linear,step:function(a){b.style.opacity=a.opacity/100,c&&(c.style.opacity=a.opacity/100),d&&(d.style.opacity=a.opacity/100)},complete:function(){b.removeAttribute("style"),c&&c.removeAttribute("style"),d&&d.removeAttribute("style")}}).animate()):(b.style.display="none",c&&c.setAttribute("style","display: none !important"),d&&d.setAttribute("style","display: none !important")))},shouldBeSectionVisible:function(a,b){var c=!1;if(!a||!a.length)return c;for(;b<a.length;b++)if("true"==a[b].getAttribute("data-visited")){c=!0;break}return c},changeVisibleContent:function(){var a,b,c=this.orderBlockNode.querySelectorAll(".bx-soa-section.bx-active");for(a=0;a<c.length;a++)b=!!this.result.IS_AUTHORIZED||this.shouldBeSectionVisible(c,a),this.changeVisibleSection(c[a],b);this.result.IS_AUTHORIZED||"final_step"!=this.params.SHOW_ORDER_BUTTON||this.switchOrderSaveButtons("true"==c[c.length-1].getAttribute("data-visited"))},changeVisibleSection:function(a,b){var c,d,e;a.id!==this.basketBlockNode.id&&(d=a.querySelector(".bx-soa-section-content"))&&(d.style.display=b?"":"none"),e=a.querySelector(".bx-soa-editstep"),e&&(e.style.display=b?"":"none"),(c=a.querySelector(".bx-soa-section-title-container"))&&!b&&BX.unbindAll(c)},editOrder:function(){if(this.orderBlockNode&&this.result){this.result.DELIVERY.length>0?(BX.addClass(this.deliveryBlockNode,"bx-active"),this.deliveryBlockNode.removeAttribute("style")):(BX.removeClass(this.deliveryBlockNode,"bx-active"),this.deliveryBlockNode.style.display="none"),this.orderSaveBlockNode.style.display=this.result.SHOW_AUTH?"none":"",this.mobileTotalBlockNode.style.display=this.result.SHOW_AUTH?"none":"",this.checkPickUpShow();var a,b=this.orderBlockNode.querySelectorAll(".bx-soa-section.bx-active");for(a in b)b.hasOwnProperty(a)&&this.editSection(b[a]);this.editTotalBlock(),this.totalBlockFixFont(),this.result.SHOW_AUTH||this.changeVisibleContent(),this.showErrors(this.result.ERROR,!1),this.showWarnings()}},editSection:function(a){if(a&&a.id){this.result.SHOW_AUTH&&a.id!=this.authBlockNode.id&&a.id!=this.basketBlockNode.id?a.style.display="none":a.id!=this.pickUpBlockNode.id&&(a.style.display="");var b,c,d=a.id==this.activeSectionId,e=a.querySelector(".bx-soa-section-title-container");switch(BX.unbindAll(e),this.result.SHOW_AUTH?BX.bind(e,"click",BX.proxy(function(){this.animateScrollTo(this.authBlockNode),this.addAnimationEffect(this.authBlockNode,"bx-step-good")},this)):(BX.bind(e,"click",BX.proxy(this.showByClick,this)),(b=e.querySelector(".bx-soa-editstep"))&&BX.bind(b,"click",BX.proxy(this.showByClick,this))),c=a.querySelector(".alert.alert-danger"),this.hasErrorSection[a.id]=c&&"none"!=c.style.display,a.id){case this.authBlockNode.id:this.editAuthBlock();break;case this.basketBlockNode.id:this.editBasketBlock(d);break;case this.regionBlockNode.id:this.editRegionBlock(d);break;case this.paySystemBlockNode.id:this.editPaySystemBlock(d);break;case this.deliveryBlockNode.id:this.editDeliveryBlock(d);break;case this.pickUpBlockNode.id:this.editPickUpBlock(d);break;case this.propsBlockNode.id:this.editPropsBlock(d)}d&&a.setAttribute("data-visited","true")}},editAuthBlock:function(){if(this.authBlockNode){var a,b,c=this.authBlockNode.querySelector(".bx-soa-section-content");BX.hasClass(c,"reg")?(a=c,c=BX.firstChild(this.authHiddenBlockNode)):a=BX.firstChild(this.authHiddenBlockNode),BX.cleanNode(c),BX.cleanNode(a),this.result.SHOW_AUTH?(this.getErrorContainer(c),this.editAuthorizeForm(c),this.editSocialContent(c),this.getAuthReference(c),this.getErrorContainer(a),this.editRegistrationForm(a),this.getAuthReference(a)):this.closeAuthBlock(),this.result.OK_MESSAGE&&this.result.OK_MESSAGE.length&&(this.toggleAuthForm({target:this.authBlockNode.querySelector("input[type=submit]")}),b=BX.create("DIV",{props:{className:"alert alert-success"},text:this.result.OK_MESSAGE.join()}),this.result.OK_MESSAGE="",BX.prepend(b,this.authBlockNode.querySelector(".bx-soa-section-content")))}},editAuthorizeForm:function(a){var b,c,d,e,f;b=this.createAuthFormInputContainer(BX.message("STOF_LOGIN"),BX.create("INPUT",{attrs:{"data-next":"USER_PASSWORD"},props:{name:"USER_LOGIN",type:"text",value:this.result.AUTH.USER_LOGIN,maxlength:"30"},events:{keypress:BX.proxy(this.checkKeyPress,this)}})),c=this.createAuthFormInputContainer(BX.message("STOF_PASSWORD"),BX.create("INPUT",{attrs:{"data-send":!0},props:{name:"USER_PASSWORD",type:"password",value:"",maxlength:"30"},events:{keypress:BX.proxy(this.checkKeyPress,this)}})),d=BX.create("DIV",{props:{className:"bx-authform-formgroup-container"},children:[BX.create("DIV",{props:{className:"checkbox"},children:[BX.create("LABEL",{props:{className:"bx-filter-param-label"},children:[BX.create("INPUT",{props:{type:"checkbox",name:"USER_REMEMBER",value:"Y"}}),BX.create("SPAN",{props:{className:"bx-filter-param-text"},text:BX.message("STOF_REMEMBER")})]})]})]}),e=BX.create("DIV",{props:{className:"bx-authform-formgroup-container"},children:[BX.create("INPUT",{props:{id:"do_authorize",type:"hidden",name:"do_authorize",value:"N"}}),BX.create("INPUT",{props:{type:"submit",className:"btn btn-lg btn-default",value:BX.message("STOF_ENTER")},events:{click:BX.proxy(function(a){return BX("do_authorize").value="Y",this.sendRequest("showAuthForm"),BX.PreventDefault(a)},this)}})]}),f=BX.create("DIV",{props:{className:"bx-authform"},children:[BX.create("H3",{props:{className:"bx-title"},text:BX.message("STOF_AUTH_REQUEST")}),b,c,d,e,BX.create("A",{props:{href:this.params.PATH_TO_AUTH+"?forgot_password=yes&back_url="+encodeURIComponent(document.location.href)},text:BX.message("STOF_FORGET_PASSWORD")})]}),a.appendChild(BX.create("DIV",{props:{className:"col-md-6"},children:[f]}))},createAuthFormInputContainer:function(a,b,c){var d="";return c&&(d+='<span class="bx-authform-starrequired">*</span>'),d+=a,BX.create("DIV",{props:{className:"bx-authform-formgroup-container"},children:[BX.create("DIV",{props:{className:"bx-authform-label-container"},html:d}),BX.create("DIV",{props:{className:"bx-authform-input-container"},children:[b]})]})},editRegistrationForm:function(a){if(this.result.AUTH){var b=[];b.push(BX.create("H3",{props:{className:"bx-title"},text:BX.message("STOF_REG_REQUEST")})),b.push(this.createAuthFormInputContainer(BX.message("STOF_NAME"),BX.create("INPUT",{attrs:{"data-next":"NEW_LAST_NAME"},props:{name:"NEW_NAME",type:"text",size:40,value:this.result.AUTH.NEW_NAME||""},events:{keypress:BX.proxy(this.checkKeyPress,this)}}),!0)),b.push(this.createAuthFormInputContainer(BX.message("STOF_LASTNAME"),BX.create("INPUT",{attrs:{"data-next":"NEW_EMAIL"},props:{name:"NEW_LAST_NAME",type:"text",size:40,value:this.result.AUTH.NEW_LAST_NAME||""},events:{keypress:BX.proxy(this.checkKeyPress,this)}}),!0)),b.push(this.createAuthFormInputContainer(BX.message("STOF_EMAIL"),BX.create("INPUT",{attrs:{"data-next":"captcha_word"},props:{name:"NEW_EMAIL",type:"text",size:40,value:this.result.AUTH.NEW_EMAIL||""},events:{keypress:BX.proxy(this.checkKeyPress,this)}}),"Y"==this.result.AUTH.new_user_email_required)),"Y"!=this.result.AUTH.new_user_registration_email_confirmation&&(b.push(BX.create("LABEL",{props:{for:"NEW_GENERATE_N"},children:[BX.create("INPUT",{attrs:{checked:!this.authGenerateUser},props:{id:"NEW_GENERATE_N",type:"radio",name:"NEW_GENERATE",value:"N"}}),BX.message("STOF_MY_PASSWORD")],events:{change:BX.proxy(function(){this.authBlockNode.querySelector(".generated").style.display="",this.authGenerateUser=!1},this)}})),b.push(BX.create("BR")),b.push(BX.create("LABEL",{props:{for:"NEW_GENERATE_Y"},children:[BX.create("INPUT",{attrs:{checked:this.authGenerateUser},props:{id:"NEW_GENERATE_Y",type:"radio",name:"NEW_GENERATE",value:"Y"}}),BX.message("STOF_SYS_PASSWORD")],events:{change:BX.proxy(function(){this.authBlockNode.querySelector(".generated").style.display="none",this.authGenerateUser=!0},this)}}))),b.push(BX.create("DIV",{props:{className:"generated"},style:{display:this.authGenerateUser?"none":""},children:[this.createAuthFormInputContainer(BX.message("STOF_LOGIN"),BX.create("INPUT",{props:{name:"NEW_LOGIN",type:"text",size:30,value:this.result.AUTH.NEW_LOGIN||""},events:{keypress:BX.proxy(this.checkKeyPress,this)}}),!0),this.createAuthFormInputContainer(BX.message("STOF_PASSWORD"),BX.create("INPUT",{props:{name:"NEW_PASSWORD",type:"password",size:30},events:{keypress:BX.proxy(this.checkKeyPress,this)}}),!0),this.createAuthFormInputContainer(BX.message("STOF_RE_PASSWORD"),BX.create("INPUT",{props:{name:"NEW_PASSWORD_CONFIRM",type:"password",size:30},events:{keypress:BX.proxy(this.checkKeyPress,this)}}),!0)]})),"Y"==this.result.AUTH.captcha_registration&&b.push(BX.create("DIV",{props:{className:"bx-authform-formgroup-container"},children:[BX.create("DIV",{props:{className:"bx-authform-label-container"},children:[BX.create("SPAN",{props:{className:"bx-authform-starrequired"},text:"*"}),BX.message("CAPTCHA_REGF_PROMT"),BX.create("DIV",{props:{className:"bx-captcha"},children:[BX.create("INPUT",{props:{name:"captcha_sid",type:"hidden",value:this.result.AUTH.capCode||""}}),BX.create("IMG",{props:{src:"/bitrix/tools/captcha.php?captcha_sid="+this.result.AUTH.capCode,alt:""}})]})]}),BX.create("DIV",{props:{className:"bx-authform-input-container"},children:[BX.create("INPUT",{attrs:{"data-send":!0},props:{name:"captcha_word",type:"text",size:"30",maxlength:"50",value:""},events:{keypress:BX.proxy(this.checkKeyPress,this)}})]})]})),b.push(BX.create("DIV",{props:{className:"bx-authform-formgroup-container"},children:[BX.create("INPUT",{props:{id:"do_register",name:"do_register",type:"hidden",value:"N"}}),BX.create("INPUT",{props:{type:"submit",className:"btn btn-lg btn-default",value:BX.message("STOF_REGISTER")},events:{click:BX.proxy(function(a){return BX("do_register").value="Y",this.sendRequest("showAuthForm"),BX.PreventDefault(a)},this)}}),BX.create("A",{props:{className:"btn btn-link",href:""},text:BX.message("STOF_DO_AUTHORIZE"),events:{click:BX.proxy(function(a){return this.toggleAuthForm(a),BX.PreventDefault(a)},this)}})]})),a.appendChild(BX.create("DIV",{props:{className:"col-md-12"},children:[BX.create("DIV",{props:{className:"bx-authform"},children:b})]}))}},editSocialContent:function(a){if(BX("bx-soa-soc-auth-services")){var b=[],c=BX("bx-soa-soc-auth-services").querySelector(".bx-authform-social");c&&(b.push(BX.create("DIV",{props:{className:"bx-authform-social"},children:[BX.create("H3",{props:{className:"bx-title"},text:BX.message("SOA_DO_SOC_SERV")}),c.cloneNode(!0)]})),b.push(BX.create("hr",{props:{className:"bxe-light"}}))),b.push(BX.create("DIV",{props:{className:"bx-soa-reg-block"},children:[BX.create("P",{text:this.params.MESS_REGISTRATION_REFERENCE}),BX.create("A",{props:{className:"btn btn-default btn-lg"},text:BX.message("STOF_DO_REGISTER"),events:{click:BX.proxy(function(a){return this.toggleAuthForm(a),BX.PreventDefault(a)},this)}})]})),a.appendChild(BX.create("DIV",{props:{className:"col-md-6"},children:b}))}},getAuthReference:function(a){a.appendChild(BX.create("DIV",{props:{className:"row"},children:[BX.create("DIV",{props:{className:"bx-soa-reference col-xs-12"},children:[BX.util.htmlspecialchars(this.params.MESS_AUTH_REFERENCE_1),BX.create("BR"),BX.util.htmlspecialchars(this.params.MESS_AUTH_REFERENCE_2),BX.create("BR"),BX.util.htmlspecialchars(this.params.MESS_AUTH_REFERENCE_3)]})]}))},toggleAuthForm:function(a){if(a){var b=a.target||a.srcElement,c=BX.findParent(b,{className:"bx-soa-section"}),d=BX.findParent(b,{className:"bx-soa-section-content"}),e=BX.firstChild(this.authHiddenBlockNode);new BX.easing({duration:100,start:{opacity:100},finish:{opacity:0},transition:BX.easing.makeEaseOut(BX.easing.transitions.quad),step:function(a){d.style.opacity=a.opacity/100}}).animate(),this.authHiddenBlockNode.appendChild(d),BX.cleanNode(c),c.appendChild(BX.create("DIV",{props:{className:"bx-soa-section-title-container"},children:[BX.create("h2",{props:{className:"bx-soa-section-title col-xs-7 col-sm-9"},text:BX.hasClass(e,"reg")?this.params.MESS_REG_BLOCK_NAME:this.params.MESS_AUTH_BLOCK_NAME})]})),e.style.opacity=0,c.appendChild(e),setTimeout(function(){new BX.easing({duration:100,start:{opacity:0},finish:{opacity:100},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(a){e.style.opacity=a.opacity/100},complete:function(){e.style.height="",e.style.opacity=""}}).animate()},110),this.animateScrollTo(c)}},alignBasketColumns:function(){if(this.basketBlockNode){var a,b,c,d,e=0,f=0,g=BX.GetWindowInnerSize();if(g.innerWidth>580&&g.innerWidth<992){if(c=this.basketBlockNode.querySelectorAll(".bx-soa-basket-info"),d=100,c.length){if(b=c[0].querySelectorAll(".bx-soa-item-properties"),b.length&&""!=b[0].style.width)return;if((f=b.length)>0)for(f=f>4?4:f,d=parseInt(d/f);e<c.length;e++)for(b=c[e].querySelectorAll(".bx-soa-item-properties"),a=0;a<b.length;a++)b[a].style.width=d+"%"}}else{if(b=this.basketBlockNode.querySelectorAll(".bx-soa-item-properties"),b.length&&""==b[0].style.width)return;for(;e<b.length;e++)b[e].style.width=""}}},editBasketBlock:function(a){this.basketBlockNode&&this.basketHiddenBlockNode&&this.result.GRID&&(BX.remove(BX.lastChild(this.basketBlockNode)),BX.remove(BX.lastChild(this.basketHiddenBlockNode)),this.editActiveBasketBlock(a),this.editFadeBasketBlock(a),this.initialized.basket=!0)},editActiveBasketBlock:function(a){var b,c,d=a?this.basketBlockNode:this.basketHiddenBlockNode;this.initialized.basket?(this.basketHiddenBlockNode.appendChild(BX.lastChild(d)),d.appendChild(BX.firstChild(this.basketHiddenBlockNode))):(b=d.querySelector(".bx-soa-section-content"),c=BX.create("DIV",{props:{className:"bx-soa-item-table"}}),b?BX.cleanNode(b):(b=this.getNewContainer(),d.appendChild(b)),this.editBasketItems(c,!0),b.appendChild(BX.create("DIV",{props:{className:"bx-soa-table-fade"},children:[BX.create("DIV",{style:{overflowX:"auto",overflowY:"hidden"},children:[c]})]})),"Y"==this.params.SHOW_COUPONS_BASKET&&this.editCoupons(b),this.getBlockFooter(b),BX.bind(b.querySelector("div.bx-soa-table-fade").firstChild,"scroll",BX.proxy(this.basketBlockScrollCheckEvent,this))),this.alignBasketColumns()},editFadeBasketBlock:function(a){var b,c,d=a?this.basketHiddenBlockNode:this.basketBlockNode;this.initialized.basket?(this.basketHiddenBlockNode.appendChild(d.querySelector(".bx-soa-section-content")),this.basketBlockNode.appendChild(BX.firstChild(this.basketHiddenBlockNode))):(b=this.getNewContainer(),c=BX.create("DIV",{props:{className:"bx-soa-item-table"}}),this.editBasketItems(c,!1),b.appendChild(BX.create("DIV",{props:{className:"bx-soa-table-fade"},children:[BX.create("DIV",{style:{overflowX:"auto",overflowY:"hidden"},children:[c]})]})),"Y"==this.params.SHOW_COUPONS_BASKET&&this.editCouponsFade(b),d.appendChild(b),this.alignBasketColumns(),this.basketBlockScrollCheck(),BX.bind(this.basketBlockNode.querySelector("div.bx-soa-table-fade").firstChild,"scroll",BX.proxy(this.basketBlockScrollCheckEvent,this))),this.alignBasketColumns()},editBasketItems:function(a,b){if(this.result.GRID.ROWS){var c,d=0;"Y"==this.params.SHOW_BASKET_HEADERS&&this.editBasketItemsHeader(a);for(c in this.result.GRID.ROWS)this.result.GRID.ROWS.hasOwnProperty(c)&&this.createBasketItem(a,this.result.GRID.ROWS[c],d++,!!b)}},editBasketItemsHeader:function(a){if(a){var b,c,d=[BX.create("DIV",{props:{className:"bx-soa-item-td"},style:{paddingBottom:"5px"},children:[BX.create("DIV",{props:{className:"bx-soa-item-td-title"},text:BX.message("SOA_SUM_NAME")})]})],e=!1,f=0;for(c=0;c<this.result.GRID.HEADERS.length;c++)b=this.result.GRID.HEADERS[c],"NAME"!=b.id&&"PREVIEW_PICTURE"!=b.id&&"PROPS"!=b.id&&"NOTES"!=b.id&&(e=BX.util.in_array(b.id,["QUANTITY","PRICE_FORMATED","DISCOUNT_PRICE_PERCENT_FORMATED","SUM"]),d.push(BX.create("DIV",{props:{className:"bx-soa-item-td bx-soa-item-properties"+(e?" bx-text-right":"")},style:{paddingBottom:"5px"},children:[BX.create("DIV",{props:{className:"bx-soa-item-td-title"},text:b.name})]})),4==++f&&this.result.GRID.HEADERS[c+1]&&(d.push(BX.create("DIV",{props:{className:"bx-soa-item-nth-4p1"}})),f=0));a.appendChild(BX.create("DIV",{props:{className:"bx-soa-item-tr hidden-sm hidden-xs"},children:d}))}},createBasketItem:function(a,b,c,d){var e,f,g,h,i=[],j=[],k=[],l=0;for((this.options.showPreviewPicInBasket||this.options.showDetailPicInBasket)&&i.push(this.createBasketItemImg(b.data)),i.push(this.createBasketItemContent(b.data)),f=0;f<this.result.GRID.HEADERS.length;f++)e=this.result.GRID.HEADERS[f],"NAME"!=e.id&&"PREVIEW_PICTURE"!=e.id&&"PROPS"!=e.id&&"NOTES"!=e.id&&(j.push(this.createBasketItemColumn(e,b,d)),4==++l&&this.result.GRID.HEADERS[f+1]&&(j.push(BX.create("DIV",{props:{className:"bx-soa-item-nth-4p1"}})),l=0));if(d)for(f=0;f<this.result.GRID.HEADERS_HIDDEN.length;f++)g=this.createBasketItemHiddenColumn(this.result.GRID.HEADERS_HIDDEN[f],b),BX.type.isArray(g)?k=k.concat(g):g&&k.push(g);h=[BX.create("DIV",{props:{className:"bx-soa-item-td"},style:{minWidth:"300px"},children:[BX.create("DIV",{props:{className:"bx-soa-item-block"},children:i})]})].concat(j),a.appendChild(BX.create("DIV",{props:{className:"bx-soa-item-tr bx-soa-basket-info"+(0==c?" bx-soa-item-tr-first":"")},children:h})),k.length&&a.appendChild(BX.create("DIV",{props:{className:"bx-soa-item-tr bx-soa-item-info-container"},children:[BX.create("DIV",{props:{className:"bx-soa-item-td"},children:[BX.create("A",{props:{href:"",className:"bx-soa-info-shower"},text:this.params.MESS_ADDITIONAL_PROPS,events:{click:BX.proxy(this.showAdditionalProperties,this)}}),BX.create("DIV",{props:{className:"bx-soa-item-info-block"},children:[BX.create("TABLE",{props:{className:"bx-soa-info-block"},children:k})]})]})]}))},showAdditionalProperties:function(a){var b=a.target||a.srcElement,c=b.nextSibling,d=BX.findParent(b,{className:"bx-soa-item-tr bx-soa-item-info-container"}),e=d.offsetHeight;if(BX.hasClass(c,"bx-active"))new BX.easing({duration:300,start:{opacity:100,height:e},finish:{opacity:0,height:35},transition:BX.easing.makeEaseOut(BX.easing.transitions.quad),step:function(a){c.style.opacity=a.opacity/100,d.style.height=a.height+"px"},complete:function(){BX.removeClass(c,"bx-active"),c.removeAttribute("style"),d.removeAttribute("style")}}).animate();else{c.style.opacity=0,BX.addClass(c,"bx-active");var f=c.offsetHeight+e;BX.removeClass(c,"bx-active"),c.style.paddingTop="10px",new BX.easing({duration:300,start:{opacity:0,height:e},finish:{opacity:100,height:f},transition:BX.easing.makeEaseOut(BX.easing.transitions.quad),step:function(a){c.style.opacity=a.opacity/100,d.style.height=a.height+"px"},complete:function(){BX.addClass(c,"bx-active"),c.removeAttribute("style")}}).animate()}return BX.PreventDefault(a)},createBasketItemImg:function(a){if(a){var b,c;return b=BX.create("DIV",{props:{className:"bx-soa-item-imgcontainer"}}),a.PREVIEW_PICTURE_SRC&&a.PREVIEW_PICTURE_SRC.length?c=this.getImageSources(a,"PREVIEW_PICTURE"):a.DETAIL_PICTURE_SRC&&a.DETAIL_PICTURE_SRC.length&&(c=this.getImageSources(a,"DETAIL_PICTURE")),c&&c.src_2x?b.setAttribute("style","background-image: url("+c.src_1x+");background-image: -webkit-image-set(url("+c.src_1x+") 1x, url("+c.src_2x+") 2x)"):(c=c&&c.src_1x||this.defaultBasketItemLogo,b.setAttribute("style","background-image: url("+c+");")),a.DETAIL_PAGE_URL&&a.DETAIL_PAGE_URL.length&&(b=BX.create("A",{props:{href:a.DETAIL_PAGE_URL},children:[b]})),BX.create("DIV",{props:{className:"bx-soa-item-img-block"},children:[b]})}},createBasketItemContent:function(a){var b=a.NAME||"",c=BX.util.htmlspecialchars(b),d=a.PROPS||[],e=[];if(a.DETAIL_PAGE_URL&&a.DETAIL_PAGE_URL.length&&(c='<a href="'+a.DETAIL_PAGE_URL+'">'+c+"</a>"),this.options.showPropsInBasket&&d.length)for(var f in d)if(d.hasOwnProperty(f)){var g=d[f].NAME||"",h=d[f].VALUE||"";e.push(BX.create("DIV",{props:{className:"bx-soa-item-td-title"},style:{textAlign:"left"},text:g})),e.push(BX.create("DIV",{props:{className:"bx-soa-item-td-text"},style:{textAlign:"left"},text:h})),e.push(BX.create("DIV",{props:{className:""},text:""}))}return BX.create("DIV",{props:{className:"bx-soa-item-content"},children:e.length?[BX.create("DIV",{props:{className:"bx-soa-item-title"},html:c}),BX.create("DIV",{props:{className:"bx-scu-container"},children:e})]:[BX.create("DIV",{props:{className:"bx-soa-item-title"},html:c})]})},createBasketItemColumn:function(a,b,c){if(a&&b){var d,e=b.columns[a.id]?b.columns:b.data,f=BX.util.in_array(a.id,["QUANTITY","PRICE_FORMATED","DISCOUNT_PRICE_PERCENT_FORMATED","SUM"]),g=BX.create("DIV",{props:{className:"bx-soa-item-td-text"}}),h=this.getImageSources(b.data,"DETAIL_PICTURE");if("PRICE_FORMATED"==a.id)g.appendChild(BX.create("STRONG",{props:{className:"bx-price"},text:e.PRICE_FORMATED})),parseFloat(e.DISCOUNT_PRICE)>0&&(g.appendChild(BX.create("BR")),g.appendChild(BX.create("STRONG",{props:{className:"bx-price-old"},text:e.BASE_PRICE_FORMATED}))),this.options.showPriceNotesInBasket&&c&&(g.appendChild(BX.create("BR")),g.appendChild(BX.create("SMALL",{text:e.NOTES})));else if("SUM"==a.id)g.appendChild(BX.create("STRONG",{props:{className:"bx-price all"},text:e.SUM})),parseFloat(e.DISCOUNT_PRICE)>0&&(g.appendChild(BX.create("BR")),g.appendChild(BX.create("STRONG",{props:{className:"bx-price-old"},text:e.SUM_BASE_FORMATED})));else if("DISCOUNT"==a.id)g.appendChild(BX.create("STRONG",{props:{className:"bx-price"},text:e.DISCOUNT_PRICE_PERCENT_FORMATED}));else if("DETAIL_PICTURE"==a.id&&this.options.showPreviewPicInBasket)d=BX.create("IMG",{props:{src:h&&h.src_1x||this.defaultBasketItemLogo}}),h&&h.src_1x&&h.src_orig&&BX.bind(d,"click",BX.delegate(function(a){this.popupShow(a,h.src_orig)},this)),g.appendChild(d);else if(BX.util.in_array(a.id,["QUANTITY","WEIGHT_FORMATED","DISCOUNT_PRICE_PERCENT_FORMATED"]))g.appendChild(BX.create("SPAN",{html:e[a.id]}));else{var i=e[a.id],j=[];if(BX.type.isArray(i)){for(var k in i)i.hasOwnProperty(k)&&("image"==i[k].type?j.push(this.getImageContainer(i[k].value,i[k].source)):i[k].value&&(g.appendChild(BX.create("SPAN",{html:i[k].value})),g.appendChild(BX.create("BR"))));j.length&&g.appendChild(BX.create("DIV",{props:{className:"bx-scu-list"},children:[BX.create("UL",{props:{className:"bx-scu-itemlist"},children:j})]}))}else i&&g.appendChild(BX.create("SPAN",{html:BX.util.htmlspecialchars(i)}))}return BX.create("DIV",{props:{className:"bx-soa-item-td bx-soa-item-properties"+(f?" bx-text-right":"")},children:[BX.create("DIV",{props:{className:"bx-soa-item-td-title visible-xs visible-sm"},text:a.name}),g]})}},createBasketItemHiddenColumn:function(a,b){if(a&&b){var c,d,e=b.columns[a.id]?b.columns:b.data,f=BX.create("TD",{props:{className:"bx-soa-info-text"}}),g=this.getImageSources(b.data,"DETAIL_PICTURE");if("PROPS"!=a.id){if("PRICE_FORMATED"==a.id)f.appendChild(BX.create("STRONG",{props:{className:"bx-price"},text:e.PRICE_FORMATED})),parseFloat(e.DISCOUNT_PRICE)>0&&(f.appendChild(BX.create("BR")),f.appendChild(BX.create("STRONG",{props:{className:"bx-price-old"},text:e.BASE_PRICE_FORMATED})));else if("SUM"==a.id)f.appendChild(BX.create("STRONG",{props:{className:"bx-price all"},text:e.SUM}));else if("DISCOUNT"==a.id)f.appendChild(BX.create("STRONG",{props:{className:"bx-price"},text:e.DISCOUNT_PRICE_PERCENT_FORMATED}));else if("DETAIL_PICTURE"==a.id||"PREVIEW_PICTURE"==a.id)c=BX.create("IMG",{props:{src:g&&g.src_1x||this.defaultBasketItemLogo},style:{maxWidth:"50%"}}),g&&g.src_1x&&g.src_orig&&BX.bind(c,"click",BX.delegate(function(a){this.popupShow(a,g.src_orig)},this)),f.appendChild(c);else if(BX.util.in_array(a.id,["QUANTITY","WEIGHT_FORMATED","DISCOUNT_PRICE_PERCENT_FORMATED"]))f.appendChild(BX.create("SPAN",{html:e[a.id]}));else{var h=e[a.id],i=[];if(BX.type.isArray(h)){for(d in h)if(h.hasOwnProperty(d))if("image"==h[d].type)i.push(this.getImageContainer(h[d].value,h[d].source));else{if(!h[d].value)return;f.appendChild(BX.create("SPAN",{html:h[d].value})),f.appendChild(BX.create("BR"))}i.length&&f.appendChild(BX.create("DIV",{props:{className:"bx-scu-list"},children:[BX.create("UL",{props:{className:"bx-scu-itemlist"},children:i})]}))}else{if(!h)return;f.appendChild(BX.create("SPAN",{html:BX.util.htmlspecialchars(h)}))}}return BX.create("TR",{props:{className:"bx-soa-info-line"},children:[BX.create("TD",{props:{className:"bx-soa-info-title"},text:a.name+":"}),f]})}var j=[],k=b.data.PROPS;if(k&&k.length){for(d in k)if(k.hasOwnProperty(d)){var l=k[d].NAME||"",m=k[d].VALUE||"";if(0==m.length)continue;j.push(BX.create("TR",{props:{className:"bx-soa-info-line"},children:[BX.create("TD",{props:{className:"bx-soa-info-title"},text:l+":"}),BX.create("TD",{props:{className:"bx-soa-info-text"},html:BX.util.htmlspecialchars(m)})]}))}return j}}},popupShow:function(a,b,c){this.popup&&this.popup.destroy();var d=this;this.popup=new BX.PopupWindow("bx-soa-image-popup",null,{lightShadow:!0,offsetTop:0,offsetLeft:0,closeIcon:{top:"3px",right:"10px"},autoHide:!0,bindOptions:{position:"bottom"},closeByEsc:!0,zIndex:100,events:{onPopupShow:function(){BX.create("IMG",{props:{src:c||b},events:{load:function(){var a=BX("bx-soa-image-popup-content");if(a){var b,c,e=BX.GetWindowInnerSize(),f=this.isMobile?.5:.9;BX.cleanNode(a),a.appendChild(this),b=a.offsetHeight,c=a.offsetWidth,b>e.innerHeight*f&&(a.style.height=e.innerHeight*f+"px",a.style.width=c*(e.innerHeight*f/b)+"px",b=a.offsetHeight,c=a.offsetWidth),c>e.innerWidth*f&&(a.style.width=e.innerWidth*f+"px",a.style.height=b*(e.innerWidth*f/c)+"px"),d.popup.adjustPosition()}}}})},onPopupClose:function(){this.destroy()}},content:BX.create("DIV",{props:{id:"bx-soa-image-popup-content"},children:[BX.create("IMG",{props:{src:this.templateFolder+"/images/loader.gif"}})]})}),this.popup.show()},getImageContainer:function(a,b){return BX.create("LI",{props:{className:"bx-img-item"},children:[BX.create("DIV",{props:{className:"bx-scu-itemColorBlock"},children:[BX.create("DIV",{props:{className:"bx-img-itemColor"},style:{backgroundImage:"url("+a+")"}})],events:{click:BX.delegate(function(c){this.popupShow(c,a,b)},this)}})]})},editCoupons:function(a){var b=this.getCouponsList(!0),c=this.getCouponsLabel(!0),d=BX.create("DIV",{props:{className:"bx-soa-coupon-block"},children:[BX.create("DIV",{props:{className:"bx-soa-coupon-input"},children:[BX.create("INPUT",{props:{id:"coupon",className:"form-control bx-ios-fix",type:"text"},events:{change:BX.proxy(function(){var a=BX("coupon");a&&a.value&&this.sendRequest("enterCoupon",a.value)},this)}})]}),BX.create("SPAN",{props:{className:"bx-soa-coupon-item"},children:b})]});a.appendChild(BX.create("DIV",{props:{className:"bx-soa-coupon"},children:[c,d]}))},editCouponsFade:function(a){if(!(this.result.COUPON_LIST.length<1)){var b,c,d=this.getCouponsList(!1);d.length&&(b=this.getCouponsLabel(!1),c=BX.create("DIV",{props:{className:"bx-soa-coupon-block"},children:[BX.create("DIV",{props:{className:"bx-soa-coupon-list"},children:[BX.create("DIV",{props:{className:"bx-soa-coupon-item"},children:[b].concat(d)})]})]}),a.appendChild(BX.create("DIV",{props:{className:"bx-soa-coupon bx-soa-coupon-item-fixed"},children:[c]})))}},getCouponsList:function(a){var b,c=[];for(b=0;b<this.result.COUPON_LIST.length;b++)(a||!a&&"APPLIED"==this.result.COUPON_LIST[b].JS_STATUS)&&c.push(this.getCouponNode({text:this.result.COUPON_LIST[b].COUPON,desc:this.result.COUPON_LIST[b].JS_CHECK_CODE,status:this.result.COUPON_LIST[b].JS_STATUS},a));return c},getCouponNode:function(a,b){var c,d,e=BX.util.htmlspecialchars(a.text)||"",f=a.desc&&a.desc.length?a.desc.charAt(0).toUpperCase()+a.desc.slice(1):BX.message("SOA_NOT_FOUND"),g=a.status||"BAD";switch(g.toUpperCase()){case"ENTERED":c="used",d="warning";break;case"BAD":c=d="danger";break;default:c=d="success"}return BX.create("STRONG",{attrs:{"data-coupon":e,className:"bx-soa-coupon-item-"+c},children:b?[e||"",BX.create("SPAN",{props:{className:"bx-soa-coupon-remove"},events:{click:BX.proxy(function(a){
var b=a.target||a.srcElement,c=BX.findParent(b,{tagName:"STRONG"});c&&c.getAttribute("data-coupon")&&this.sendRequest("removeCoupon",c.getAttribute("data-coupon"))},this)}}),BX.create("SPAN",{props:{className:"bx-soa-tooltip bx-soa-tooltip-coupon bx-soa-tooltip-"+d+" tooltip top"},children:[BX.create("SPAN",{props:{className:"tooltip-arrow"}}),BX.create("SPAN",{props:{className:"tooltip-inner"},text:f})]})]:[e]})},getCouponsLabel:function(a){return BX.create("DIV",{props:{className:"bx-soa-coupon-label"},children:a?[BX.create("LABEL",{attr:{for:"coupon"},text:this.params.MESS_USE_COUPON+":"})]:[BX.util.htmlspecialchars(this.params.MESS_COUPON)+":"]})},addCoupon:function(a){var b,c=this.orderBlockNode.querySelectorAll(".bx-soa-coupon:not(.bx-soa-coupon-item-fixed) .bx-soa-coupon-item"),d=BX("coupon");for(b=0;b<c.length;b++)c[b].appendChild(this.getCouponNode({text:a},!0,"bx-soa-coupon-item-danger"));d&&(d.value="")},removeCoupon:function(a){var b,c=this.orderBlockNode.querySelectorAll('[data-coupon="'+a+'"]');for(b in c)c.hasOwnProperty(b)&&BX.remove(c[b])},editRegionBlock:function(a){this.regionBlockNode&&this.regionHiddenBlockNode&&this.result.PERSON_TYPE&&(a?(this.editActiveRegionBlock(!0),!this.regionBlockNotEmpty&&this.editFadeRegionBlock()):this.editFadeRegionBlock(),this.initialized.region=!0)},editActiveRegionBlock:function(a){var b,c,d,e=a?this.regionBlockNode:this.regionHiddenBlockNode;this.initialized.region?(BX.remove(BX.lastChild(e)),e.appendChild(BX.firstChild(this.regionHiddenBlockNode))):(b=e.querySelector(".bx-soa-section-content"),b?BX.cleanNode(b):(b=this.getNewContainer(),e.appendChild(b)),this.getErrorContainer(b),c=BX.create("DIV",{props:{className:"bx_soa_location row"}}),d=BX.create("DIV",{props:{className:"col-xs-12"}}),this.getPersonTypeControl(d),this.getProfilesControl(d),this.getDeliveryLocationInput(d),this.result.SHOW_AUTH||(this.regionBlockNotEmpty?(BX.addClass(this.regionBlockNode,"bx-active"),this.regionBlockNode.style.display=""):(BX.removeClass(this.regionBlockNode,"bx-active"),this.regionBlockNode.style.display="none",this.result.IS_AUTHORIZED&&!this.result.LAST_ORDER_DATA.FAIL||this.initFirstSection())),c.appendChild(d),b.appendChild(c),this.getBlockFooter(b))},editFadeRegionBlock:function(){var a,b=this.regionBlockNode.querySelector(".bx-soa-section-content");this.initialized.region?this.regionHiddenBlockNode.appendChild(b):(this.editActiveRegionBlock(!1),BX.remove(BX.lastChild(this.regionBlockNode))),a=this.getNewContainer(!0),this.regionBlockNode.appendChild(a),this.editFadeRegionContent(a)},editFadeRegionContent:function(a){if(a&&this.locationsInitialized){var b,c,d,e,f,g,h,i,j=this.getSelectedPersonType(),k=this.regionHiddenBlockNode.querySelector(".alert.alert-danger"),l="",m=[],n="";BX.cleanNode(a),k&&a.appendChild(k.cloneNode(!0)),j&&j.NAME&&BX.util.object_keys(this.result.PERSON_TYPE).length>1&&(l+="<span>"+BX.util.htmlspecialchars(this.params.MESS_PERSON_TYPE)+":</span> "+j.NAME+"<br />"),j&&(e="PROPS_FADE_LIST_"+j.ID,m=this.params[e]||[]);for(f in this.result.ORDER_PROP.properties)if(this.result.ORDER_PROP.properties.hasOwnProperty(f))if("Y"==this.result.ORDER_PROP.properties[f].IS_LOCATION)b=this.result.ORDER_PROP.properties[f];else if("Y"==this.result.ORDER_PROP.properties[f].IS_ZIP)for(d=this.result.ORDER_PROP.properties[f],g=0;g<m.length;g++)if(m[g]==d.ID){c=BX("zipProperty"),n=c&&c.value&&c.value.length?c.value:BX.message("SOA_NOT_SPECIFIED");break}h=this.getLocationString(this.regionHiddenBlockNode),b&&h.length&&(l+="<span>"+BX.util.htmlspecialchars(b.NAME)+":</span> "+h+"<br />"),d&&n.length&&(l+="<span>"+BX.util.htmlspecialchars(d.NAME)+":</span> "+n),a.innerHTML+=l,"true"==this.regionBlockNode.getAttribute("data-visited")&&(i=this.isValidRegionBlock(),i.length?(BX.addClass(this.regionBlockNode,"bx-step-error"),this.showError(this.regionBlockNode,i)):BX.removeClass(this.regionBlockNode,"bx-step-error")),BX.bind(a.querySelector(".alert.alert-danger"),"click",BX.proxy(this.showByClick,this)),BX.bind(a.querySelector(".alert.alert-warning"),"click",BX.proxy(this.showByClick,this))}},getSelectedPersonType:function(){var a,b,c,d,e=BX.util.object_keys(this.result.PERSON_TYPE).length;if(1==e?(a=this.regionBlockNode.querySelector("input[type=hidden][name=PERSON_TYPE]"))||(a=this.regionHiddenBlockNode.querySelector("input[type=hidden][name=PERSON_TYPE]")):2==e?(a=this.regionBlockNode.querySelector("input[type=radio][name=PERSON_TYPE]:checked"))||(a=this.regionHiddenBlockNode.querySelector("input[type=radio][name=PERSON_TYPE]:checked")):(a=this.regionBlockNode.querySelector("select[name=PERSON_TYPE] > option:checked"))||(a=this.regionHiddenBlockNode.querySelector("select[name=PERSON_TYPE] > option:checked")),a){c=a.value;for(d in this.result.PERSON_TYPE)if(this.result.PERSON_TYPE[d].ID==c){b=this.result.PERSON_TYPE[d];break}}return b},getDeliveryLocationInput:function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n;for(f in this.result.ORDER_PROP.properties)if(this.result.ORDER_PROP.properties.hasOwnProperty(f)&&(b=this.result.ORDER_PROP.properties[f],"Y"==b.IS_LOCATION)){c=b.ID,d=parseInt(b.INPUT_FIELD_LOCATION);break}if((e=this.locations[c])&&e[0]&&e[0].output){this.regionBlockNotEmpty=!0,h='<label class="bx-soa-custom-label" for="soa-property-'+c+'">'+("Y"==b.REQUIRED?'<span class="bx-authform-starrequired">*</span> ':"")+BX.util.htmlspecialchars(b.NAME)+(b.DESCRIPTION.length?" <small>("+BX.util.htmlspecialchars(b.DESCRIPTION)+")</small>":"")+"</label>",i=e[0].output,j=BX.create("DIV",{attrs:{"data-property-id-row":c},props:{className:"form-group bx-soa-location-input-container"},style:{visibility:"hidden"},html:h+i.HTML}),a.appendChild(j);for(f in i.SCRIPT)i.SCRIPT.hasOwnProperty(f)&&BX.evalGlobal(i.SCRIPT[f].JS)}if(e&&e[0]&&e[0].showAlt&&d>0)for(f in this.result.ORDER_PROP.properties)if(parseInt(this.result.ORDER_PROP.properties[f].ID)==d){g=this.result.ORDER_PROP.properties[f];break}g&&(n=BX.create("DIV",{attrs:{"data-property-id-row":g.ID},props:{className:"form-group bx-soa-location-input-container"}}),k="Y"==g.REQUIRED?'<span class="bx-authform-starrequired">*</span> ':"",k+=BX.util.htmlspecialchars(g.NAME),l=BX.create("LABEL",{attrs:{for:"altProperty"},props:{className:"bx-soa-custom-label"},html:k}),m=BX.create("INPUT",{props:{id:"altProperty",type:"text",placeholder:g.DESCRIPTION,autocomplete:"city",className:"form-control bx-soa-customer-input bx-ios-fix",name:"ORDER_PROP_"+g.ID,value:g.VALUE}}),n.appendChild(l),n.appendChild(m),a.appendChild(n),this.bindValidation(g.ID,n)),this.getZipLocationInput(a),e&&e[0]&&a.appendChild(BX.create("DIV",{props:{className:"bx-soa-reference"},text:this.params.MESS_REGION_REFERENCE}))},getLocationString:function(a){if(!a)return"";var b,c,d,e=a.querySelector(".bx-ui-sls-route"),f="";if(e&&e.value&&e.value.length)f=e.value;else{for(b=a.querySelectorAll(".bx-ui-combobox-fake.bx-combobox-fake-as-input"),c=b.length;c--;)b[c].innerHTML.indexOf("...")>=0||(b[c].innerHTML.indexOf("---")>=0?(d=BX("altProperty"))&&d.value.length&&(f+=d.value):(f.length&&(f+=", "),f+=b[c].innerHTML));0==f.length&&(f=BX.message("SOA_NOT_SPECIFIED"))}return f},getZipLocationInput:function(a){var b,c,d,e,f,g;for(c in this.result.ORDER_PROP.properties)if(this.result.ORDER_PROP.properties.hasOwnProperty(c)&&"Y"==this.result.ORDER_PROP.properties[c].IS_ZIP){b=this.result.ORDER_PROP.properties[c];break}b&&(this.regionBlockNotEmpty=!0,d=BX.create("DIV",{props:{className:"form-group bx-soa-location-input-container"}}),d.setAttribute("data-property-id-row",b.ID),e="Y"==b.REQUIRED?'<span class="bx-authform-starrequired">*</span> ':"",e+=BX.util.htmlspecialchars(b.NAME),f=BX.create("LABEL",{attrs:{for:"zipProperty"},props:{className:"bx-soa-custom-label"},html:e}),g=BX.create("INPUT",{props:{id:"zipProperty",type:"text",placeholder:b.DESCRIPTION,autocomplete:"zip",className:"form-control bx-soa-customer-input bx-ios-fix",name:"ORDER_PROP_"+b.ID,value:b.VALUE}}),d.appendChild(f),d.appendChild(g),a.appendChild(d),this.bindValidation(b.ID,d))},getPersonTypeControl:function(a){if(this.result.PERSON_TYPE){var b,c,d,e,f,g=BX.util.object_keys(this.result.PERSON_TYPE).length,h=[],i=!1;if(g>1&&(e=BX.create("DIV",{props:{className:"form-group"},children:[BX.create("LABEL",{props:{className:"bx-soa-custom-label"},text:this.params.MESS_PERSON_TYPE}),BX.create("BR")]}),a.appendChild(e),a=e),g>2){for(d in this.result.PERSON_TYPE)this.result.PERSON_TYPE.hasOwnProperty(d)&&(b=this.result.PERSON_TYPE[d],h.push(BX.create("OPTION",{props:{value:b.ID,selected:"Y"==b.CHECKED},text:b.NAME})),"Y"==b.CHECKED&&(c=b.ID));a.appendChild(BX.create("SELECT",{props:{name:"PERSON_TYPE",className:"form-control"},children:h,events:{change:BX.proxy(this.sendRequest,this)}})),this.regionBlockNotEmpty=!0}else if(2==g){for(d in this.result.PERSON_TYPE)this.result.PERSON_TYPE.hasOwnProperty(d)&&(b=this.result.PERSON_TYPE[d],f=BX.create("LABEL",{children:[BX.create("INPUT",{attrs:{checked:"Y"==b.CHECKED,className:"with-gap"},props:{type:"radio",name:"PERSON_TYPE",value:b.ID}}),BX.create("SPAN",{text:b.NAME})],events:{change:BX.proxy(this.sendRequest,this)}}),i&&a.appendChild(BX.create("BR")),a.appendChild(BX.create("DIV",{props:{className:"radio-inline"},children:[f]})),i=!0,"Y"==b.CHECKED&&(c=b.ID));this.regionBlockNotEmpty=!0}else for(d in this.result.PERSON_TYPE)this.result.PERSON_TYPE.hasOwnProperty(d)&&a.appendChild(BX.create("INPUT",{props:{type:"hidden",name:"PERSON_TYPE",value:this.result.PERSON_TYPE[d].ID}}));c&&a.appendChild(BX.create("INPUT",{props:{type:"hidden",name:"PERSON_TYPE_OLD",value:c}}))}},getProfilesControl:function(a){var b,c,d,e,f=BX.util.object_keys(this.result.USER_PROFILES).length,g=[];if(f)if("Y"==this.params.ALLOW_USER_PROFILES){if(this.regionBlockNotEmpty=!0,f>1||"Y"==this.params.ALLOW_NEW_PROFILE){c=BX.create("LABEL",{props:{className:"bx-soa-custom-label"},text:this.params.MESS_SELECT_PROFILE});for(b in this.result.USER_PROFILES)this.result.USER_PROFILES.hasOwnProperty(b)&&g.unshift(BX.create("OPTION",{props:{value:this.result.USER_PROFILES[b].ID,selected:"Y"==this.result.USER_PROFILES[b].CHECKED},html:this.result.USER_PROFILES[b].NAME}));"Y"==this.params.ALLOW_NEW_PROFILE&&g.unshift(BX.create("OPTION",{props:{value:0},text:BX.message("SOA_PROP_NEW_PROFILE")})),d=BX.create("INPUT",{props:{type:"hidden",value:"N",id:"profile_change",name:"profile_change"}}),e=BX.create("SELECT",{props:{className:"form-control",name:"PROFILE_ID"},children:g,events:{change:BX.proxy(function(){BX("profile_change").value="Y",this.sendRequest()},this)}}),a.appendChild(BX.create("DIV",{props:{className:"form-group bx-soa-location-input-container"},children:[c,d,e]}))}}else for(b in this.result.USER_PROFILES)this.result.USER_PROFILES.hasOwnProperty(b)&&"Y"==this.result.USER_PROFILES[b].CHECKED&&a.appendChild(BX.create("INPUT",{props:{name:"PROFILE_ID",type:"hidden",value:this.result.USER_PROFILES[b].ID}}))},editPaySystemBlock:function(a){this.paySystemBlockNode&&this.paySystemHiddenBlockNode&&this.result.PAY_SYSTEM&&(a?this.editActivePaySystemBlock(!0):this.editFadePaySystemBlock(),this.initialized.paySystem=!0)},editActivePaySystemBlock:function(a){var b,c,d=a?this.paySystemBlockNode:this.paySystemHiddenBlockNode;this.initialized.paySystem?(BX.remove(BX.lastChild(d)),d.appendChild(BX.firstChild(this.paySystemHiddenBlockNode))):(b=d.querySelector(".bx-soa-section-content"),b?BX.cleanNode(b):(b=this.getNewContainer(),d.appendChild(b)),this.getErrorContainer(b),c=BX.create("DIV",{props:{className:"bx-soa-pp row"}}),this.editPaySystemItems(c),b.appendChild(c),this.editPaySystemInfo(c),"Y"==this.params.SHOW_COUPONS_PAY_SYSTEM&&this.editCoupons(b),this.getBlockFooter(b))},editFadePaySystemBlock:function(){var a,b=this.paySystemBlockNode.querySelector(".bx-soa-section-content");this.initialized.paySystem?this.paySystemHiddenBlockNode.appendChild(b):(this.editActivePaySystemBlock(!1),BX.remove(BX.lastChild(this.paySystemBlockNode))),a=this.getNewContainer(!0),this.paySystemBlockNode.appendChild(a),this.editFadePaySystemContent(a),"Y"==this.params.SHOW_COUPONS_PAY_SYSTEM&&this.editCouponsFade(a)},editPaySystemItems:function(a){if(this.result.PAY_SYSTEM&&!(this.result.PAY_SYSTEM.length<=0)){var b,c,d=BX.create("DIV",{props:{className:"col-sm-7 bx-soa-pp-item-container"}});for(c=0;c<this.paySystemPagination.currentPage.length;c++)b=this.createPaySystemItem(this.paySystemPagination.currentPage[c]),d.appendChild(b);this.paySystemPagination.show&&this.showPagination("paySystem",d),a.appendChild(d)}},createPaySystemItem:function(a){var b,c,d,e,f,g="Y"==a.CHECKED,h=parseInt(a.ID);return c=BX.create("DIV",{props:{className:"bx-soa-pp-company-image"}}),b=this.getImageSources(a,"PSA_LOGOTIP"),b&&b.src_2x?c.setAttribute("style","background-image: url("+b.src_1x+");background-image: -webkit-image-set(url("+b.src_1x+") 1x, url("+b.src_2x+") 2x)"):(b=b&&b.src_1x||this.defaultPaySystemLogo,c.setAttribute("style","background-image: url("+b+");")),e=BX.create("DIV",{props:{className:"bx-soa-pp-company-graf-container"},children:[BX.create("INPUT",{props:{id:"ID_PAY_SYSTEM_ID_"+h,name:"PAY_SYSTEM_ID",type:"checkbox",className:"bx-soa-pp-company-checkbox",value:h,checked:g}}),c]}),"Y"==this.params.SHOW_PAY_SYSTEM_LIST_NAMES&&(d=BX.create("DIV",{props:{className:"bx-soa-pp-company-smalltitle"},html:a.PSA_NAME})),f=BX.create("DIV",{props:{className:"bx-soa-pp-company col-xs-6"},children:[e,d],events:{click:BX.proxy(this.selectPaySystem,this)}}),g&&BX.addClass(f,"bx-selected"),f},editPaySystemInfo:function(a){if(this.result.PAY_SYSTEM&&(0!=this.result.PAY_SYSTEM.length||"Y"==this.result.PAY_FROM_ACCOUNT)){var b,c,d,e,f,g,h,i,j,k,l=BX.create("DIV",{props:{className:(0==this.result.PAY_SYSTEM.length?"col-sm-12":"col-sm-5")+" bx-soa-pp-desc-container"}});BX.cleanNode(l),"Y"==this.result.PAY_FROM_ACCOUNT&&(b=this.getInnerPaySystem(l)),e=this.getSelectedPaySystem(),e&&(g=BX.create("DIV",{props:{className:"bx-soa-pp-company-image"}}),f=this.getImageSources(e,"PSA_LOGOTIP"),f&&f.src_2x?g.setAttribute("style","background-image: url("+f.src_1x+");background-image: -webkit-image-set(url("+f.src_1x+") 1x, url("+f.src_2x+") 2x)"):(f=f&&f.src_1x||this.defaultPaySystemLogo,g.setAttribute("style","background-image: url("+f+");")),"Y"==this.params.SHOW_PAY_SYSTEM_INFO_NAME&&(h=BX.create("DIV",{props:{className:"bx-soa-pp-company-subTitle"},html:e.PSA_NAME})),i=BX.create("DIV",{props:{className:"bx-soa-pp-company-logo"},children:[BX.create("DIV",{props:{className:"bx-soa-pp-company-graf-container"},children:[g]})]}),j=BX.create("DIV",{props:{className:"bx-soa-pp-company-block"},children:[BX.create("DIV",{props:{className:"bx-soa-pp-company-desc"},html:e.DESCRIPTION})]}),e.PRICE&&parseFloat(e.PRICE)>0&&(k=BX.create("UL",{props:{className:"bx-soa-pp-list"},children:[BX.create("LI",{children:[BX.create("DIV",{props:{className:"bx-soa-pp-list-termin"},text:this.params.MESS_PRICE+":"}),BX.create("DIV",{props:{className:"bx-soa-pp-list-description"},text:"~"+e.PRICE_FORMATTED})]})]})),c=BX.create("DIV",{children:[h,i,j,k]})),b&&c&&(d=BX.create("HR",{props:{className:"bxe-light"}})),l.appendChild(BX.create("DIV",{props:{className:"bx-soa-pp-company"},children:[b,d,c]})),a.appendChild(l)}},getInnerPaySystem:function(){if(this.result.CURRENT_BUDGET_FORMATED&&this.result.PAY_CURRENT_ACCOUNT&&this.result.INNER_PAY_SYSTEM){var a,b,c,d,e,f,g,h,i=this.params.ONLY_FULL_PAY_FROM_ACCOUNT&&"Y"==this.params.ONLY_FULL_PAY_FROM_ACCOUNT,j=this.result.PAY_CURRENT_ACCOUNT&&"Y"==this.result.PAY_CURRENT_ACCOUNT,k=this.result.INNER_PAY_SYSTEM;return"Y"==this.params.SHOW_PAY_SYSTEM_INFO_NAME&&(c=BX.create("DIV",{props:{className:"bx-soa-pp-company-subTitle"},text:k.NAME})),b=BX.create("DIV",{props:{className:"bx-soa-pp-company-image"}}),a=this.getImageSources(k,"LOGOTIP"),a&&a.src_2x?b.setAttribute("style","background-image: url("+a.src_1x+");background-image: -webkit-image-set(url("+a.src_1x+") 1x, url("+a.src_2x+") 2x)"):(a=a&&a.src_1x||this.defaultPaySystemLogo,b.setAttribute("style","background-image: url("+a+");")),d=BX.create("DIV",{props:{className:"bx-soa-pp-company-logo"},children:[BX.create("DIV",{props:{className:"bx-soa-pp-company-graf-container"},children:[BX.create("INPUT",{props:{type:"checkbox",className:"bx-soa-pp-company-checkbox",name:"PAY_CURRENT_ACCOUNT",value:"Y",checked:j}}),b],events:{click:BX.proxy(this.selectPaySystem,this)}})]}),k.DESCRIPTION&&k.DESCRIPTION.length&&(e=BX.create("DIV",{props:{className:"bx-soa-pp-company-block"},children:[BX.create("DIV",{props:{className:"bx-soa-pp-company-desc"},html:k.DESCRIPTION})]})),f=BX.create("INPUT",{props:{type:"hidden",name:"PAY_CURRENT_ACCOUNT",value:"N"}}),g=BX.util.htmlspecialchars(this.params.MESS_INNER_PS_BALANCE)+' <b class="wsnw">'+this.result.CURRENT_BUDGET_FORMATED+"</b><br />"+(i?BX.message("SOA_PAY_ACCOUNT3"):""),h=BX.create("DIV",{props:{className:"bx-soa-pp-company-desc"},html:g}),BX.create("DIV",{props:{className:"bx-soa-pp-inner-ps"+(j?" bx-selected":"")},children:[f,c,d,e,h]})}},editFadePaySystemContent:function(a){var b,c,d=this.getSelectedPaySystem(),e=this.paySystemHiddenBlockNode.querySelector("div.alert.alert-danger"),f=this.paySystemHiddenBlockNode.querySelector("div.alert.alert-warning.alert-show"),g="";e?a.appendChild(e.cloneNode(!0)):this.getErrorContainer(a),f&&f.innerHTML&&a.appendChild(f.cloneNode(!0)),this.isSelectedInnerPayment()&&(b=this.getImageSources(this.result.INNER_PAY_SYSTEM,"LOGOTIP"),c=b&&b.src_1x||this.defaultPaySystemLogo,g+='<div class="bx-soa-pp-company-selected">',g+='<img src="'+c+'" style="height:18px;" alt="">',g+="<span>"+this.result.INNER_PAY_SYSTEM.NAME+"</span><br />",g+="</div>"),d&&d.PSA_NAME&&(b=this.getImageSources(d,"PSA_LOGOTIP"),c=b&&b.src_1x||this.defaultPaySystemLogo,g+='<div class="bx-soa-pp-company-selected">',g+='<img src="'+c+'" style="height:18px;" alt="">',g+="<span>"+d.PSA_NAME+"</span>",g+="</div>"),g.length||(g="<strong>"+BX.message("SOA_PS_SELECT_ERROR")+"</strong>"),a.innerHTML+=g,a.appendChild(BX.create("DIV",{style:{clear:"both"}})),BX.bind(a.querySelector(".alert.alert-danger"),"click",BX.proxy(this.showByClick,this)),BX.bind(a.querySelector(".alert.alert-warning"),"click",BX.proxy(this.showByClick,this))},getSelectedPaySystem:function(){var a,b,c=this.paySystemBlockNode.querySelector("input[type=checkbox][name=PAY_SYSTEM_ID]:checked"),d=null;if(c||(c=this.paySystemHiddenBlockNode.querySelector("input[type=checkbox][name=PAY_SYSTEM_ID]:checked")),c||(c=this.paySystemHiddenBlockNode.querySelector("input[type=hidden][name=PAY_SYSTEM_ID]")),c)for(a=c.value,b=0;b<this.result.PAY_SYSTEM.length;b++)if(this.result.PAY_SYSTEM[b].ID==a){d=this.result.PAY_SYSTEM[b];break}return d},isSelectedInnerPayment:function(){var a=this.paySystemBlockNode.querySelector("input[type=checkbox][name=PAY_CURRENT_ACCOUNT]");return a||(a=this.paySystemHiddenBlockNode.querySelector("input[type=checkbox][name=PAY_CURRENT_ACCOUNT]")),a&&a.checked},selectPaySystem:function(a){if(this.orderBlockNode&&a){var b,c,d=a.target||a.srcElement,e=this.paySystemBlockNode.querySelector("div.bx-soa-pp-inner-ps"),f=this.paySystemBlockNode.querySelector("input[type=checkbox][name=PAY_CURRENT_ACCOUNT]"),g=this.result.TOTAL&&0===parseFloat(this.result.TOTAL.ORDER_TOTAL_LEFT_TO_PAY),h=BX.hasClass(d,"bx-soa-pp-inner-ps")?d:BX.findParent(d,{className:"bx-soa-pp-inner-ps"}),i=BX.hasClass(d,"bx-soa-pp-company")?d:BX.findParent(d,{className:"bx-soa-pp-company"});if(h)"INPUT"==d.nodeName&&(f.checked=!f.checked),f.checked?(BX.removeClass(e,"bx-selected"),f.checked=!1):(BX.addClass(e,"bx-selected"),f.checked=!0);else if(i){if(BX.hasClass(i,"bx-selected"))return BX.PreventDefault(a);f&&f.checked&&g?(BX.addClass(i,"bx-selected"),b=i.querySelector("input[type=checkbox]"),b.checked=!0,BX.removeClass(e,"bx-selected"),f.checked=!1):(c=this.paySystemBlockNode.querySelector(".bx-soa-pp-company.bx-selected"),BX.addClass(i,"bx-selected"),b=i.querySelector("input[type=checkbox]"),b.checked=!0,c&&(BX.removeClass(c,"bx-selected"),c.querySelector("input[type=checkbox]").checked=!1))}this.sendRequest()}},editDeliveryBlock:function(a){this.deliveryBlockNode&&this.deliveryHiddenBlockNode&&this.result.DELIVERY&&(a?this.editActiveDeliveryBlock(!0):this.editFadeDeliveryBlock(),this.checkPickUpShow(),this.initialized.delivery=!0)},editActiveDeliveryBlock:function(a){var b,c,d=a?this.deliveryBlockNode:this.deliveryHiddenBlockNode;this.initialized.delivery?(BX.remove(BX.lastChild(d)),d.appendChild(BX.firstChild(this.deliveryHiddenBlockNode))):(b=d.querySelector(".bx-soa-section-content"),b?BX.cleanNode(b):(b=this.getNewContainer(),d.appendChild(b)),this.getErrorContainer(b),c=BX.create("DIV",{props:{className:"bx-soa-pp row"}}),this.editDeliveryItems(c),b.appendChild(c),this.editDeliveryInfo(c),"Y"==this.params.SHOW_COUPONS_DELIVERY&&this.editCoupons(b),this.getBlockFooter(b))},editDeliveryItems:function(a){if(this.result.DELIVERY&&!(this.result.DELIVERY.length<=0)){var b,c,d=BX.create("DIV",{props:{className:"col-sm-7 bx-soa-pp-item-container"}});for(c=0;c<this.deliveryPagination.currentPage.length;c++)b=this.createDeliveryItem(this.deliveryPagination.currentPage[c]),d.appendChild(b);this.deliveryPagination.show&&this.showPagination("delivery",d),a.appendChild(d)}},editDeliveryInfo:function(a){if(this.result.DELIVERY){var b,c,d,e,f,g,h,i,j,k,l,m,n,o=BX.create("DIV",{props:{className:"col-sm-5 bx-soa-pp-desc-container"}});BX.cleanNode(o),b=this.getSelectedDelivery(),e=BX.create("DIV",{props:{className:"bx-soa-pp-company-image"}}),c=this.getImageSources(b,"LOGOTIP"),c&&c.src_2x?e.setAttribute("style","background-image: url("+c.src_1x+");background-image: -webkit-image-set(url("+c.src_1x+") 1x, url("+c.src_2x+") 2x)"):(c=c&&c.src_1x||this.defaultDeliveryLogo,e.setAttribute("style","background-image: url("+c+");")),d="N"!=this.params.SHOW_DELIVERY_PARENT_NAMES?b.NAME:b.OWN_NAME,"Y"==this.params.SHOW_DELIVERY_INFO_NAME&&(f=BX.create("DIV",{props:{className:"bx-soa-pp-company-subTitle"},text:d})),g=BX.create("DIV",{props:{className:"bx-soa-pp-company-logo"},children:[BX.create("DIV",{props:{className:"bx-soa-pp-company-graf-container"},children:[e]})]}),h=BX.create("DIV",{props:{className:"bx-soa-pp-company-block"},children:[BX.create("DIV",{props:{className:"bx-soa-pp-company-desc"},html:b.DESCRIPTION})]}),b.PRICE>=0&&(i=BX.create("LI",{children:[BX.create("DIV",{props:{className:"bx-soa-pp-list-termin"},text:this.params.MESS_PRICE+":"}),BX.create("DIV",{props:{className:"bx-soa-pp-list-description"},children:this.getDeliveryPriceNodes(b)})]})),b.PERIOD_TEXT&&b.PERIOD_TEXT.length&&(j=BX.create("LI",{children:[BX.create("DIV",{props:{className:"bx-soa-pp-list-termin"},text:this.params.MESS_PERIOD+":"}),BX.create("DIV",{props:{className:"bx-soa-pp-list-description"},html:b.PERIOD_TEXT})]})),k=BX.create("DIV",{style:{clear:"both"}}),l=BX.create("UL",{props:{className:"bx-soa-pp-list"},children:[i,j]}),m=this.getDeliveryExtraServices(b),m.length&&(n=BX.create("DIV",{props:{className:"bx-soa-pp-company-block"},children:m})),o.appendChild(BX.create("DIV",{props:{className:"bx-soa-pp-company"},children:[f,g,h,k,n,l]})),a.appendChild(o),"Y"!=this.params.DELIVERY_NO_AJAX&&(this.deliveryCachedInfo[b.ID]=b)}},getDeliveryPriceNodes:function(a){return void 0!==a.DELIVERY_DISCOUNT_PRICE&&parseFloat(a.DELIVERY_DISCOUNT_PRICE)!=parseFloat(a.PRICE)?parseFloat(a.DELIVERY_DISCOUNT_PRICE)>parseFloat(a.PRICE)?[a.DELIVERY_DISCOUNT_PRICE_FORMATED]:[a.DELIVERY_DISCOUNT_PRICE_FORMATED,BX.create("BR"),BX.create("SPAN",{props:{className:"bx-price-old"},text:a.PRICE_FORMATED})]:[a.PRICE_FORMATED]},getDeliveryExtraServices:function(a){var b,c,d,e,f,g=[],h=!1;for(b in a.EXTRA_SERVICES)a.EXTRA_SERVICES.hasOwnProperty(b)&&(c=a.EXTRA_SERVICES[b],c.canUserEditValue&&(-1==c.editControl.indexOf("this.checked")?(e=BX.create("LABEL",{text:c.name+(c.price?" ("+c.priceFormatted+")":"")}),0==b&&(h=!0),d=BX.create("DIV",{props:{className:"form-group bx-soa-pp-field"},html:c.editControl+(c.description.length?'<div class="bx-soa-service-small">'+BX.util.htmlspecialchars(c.description)+"</div>":"")}),BX.prepend(e,d),f=d.querySelector("input[type=text]"),f||(f=d.querySelector("select")),f&&BX.addClass(f,"form-control")):d=BX.create("DIV",{props:{className:"checkbox"},children:[BX.create("LABEL",{html:c.editControl+BX.util.htmlspecialchars(c.name)+(c.price?" ("+c.priceFormatted+")":"")+(c.description.length?'<div class="bx-soa-service-small">'+BX.util.htmlspecialchars(c.description)+"</div>":"")})]}),g.push(d)));return h&&g.unshift(BX.create("BR")),g},editFadeDeliveryBlock:function(){var a,b=this.deliveryBlockNode.querySelector(".bx-soa-section-content");this.initialized.delivery?this.deliveryHiddenBlockNode.appendChild(b):(this.editActiveDeliveryBlock(!1),BX.remove(BX.lastChild(this.deliveryBlockNode))),a=this.getNewContainer(!0),this.deliveryBlockNode.appendChild(a),this.editFadeDeliveryContent(a),"Y"==this.params.SHOW_COUPONS_DELIVERY&&this.editCouponsFade(a)},createDeliveryItem:function(a){var b,c,d,e,f,g="Y"==a.CHECKED,h=parseInt(a.ID),i=[BX.create("INPUT",{props:{id:"ID_DELIVERY_ID_"+h,name:"DELIVERY_ID",type:"checkbox",className:"bx-soa-pp-company-checkbox",value:h,checked:g}})],j=this.deliveryCachedInfo[h];return f=BX.create("DIV",{props:{className:"bx-soa-pp-company-image"}}),b=this.getImageSources(a,"LOGOTIP"),b&&b.src_2x?f.setAttribute("style","background-image: url("+b.src_1x+");background-image: -webkit-image-set(url("+b.src_1x+") 1x, url("+b.src_2x+") 2x)"):(b=b&&b.src_1x||this.defaultDeliveryLogo,f.setAttribute("style","background-image: url("+b+");")),i.push(f),a.PRICE>=0||void 0!==a.DELIVERY_DISCOUNT_PRICE?i.push(BX.create("DIV",{props:{className:"bx-soa-pp-delivery-cost"},text:void 0!==a.DELIVERY_DISCOUNT_PRICE?a.DELIVERY_DISCOUNT_PRICE_FORMATED:a.PRICE_FORMATED})):j&&(j.PRICE>=0||void 0!==j.DELIVERY_DISCOUNT_PRICE)&&i.push(BX.create("DIV",{props:{className:"bx-soa-pp-delivery-cost"},text:void 0!==j.DELIVERY_DISCOUNT_PRICE?j.DELIVERY_DISCOUNT_PRICE_FORMATED:j.PRICE_FORMATED})),c=BX.create("DIV",{props:{className:"bx-soa-pp-company-graf-container"+(a.CALCULATE_ERRORS||j&&j.CALCULATE_ERRORS?" bx-bd-waring":"")},children:i}),"Y"==this.params.SHOW_DELIVERY_LIST_NAMES&&(d=BX.create("DIV",{props:{className:"bx-soa-pp-company-smalltitle"},text:"N"!=this.params.SHOW_DELIVERY_PARENT_NAMES?a.NAME:a.OWN_NAME})),e=BX.create("DIV",{props:{className:"bx-soa-pp-company col-xs-6"},children:[c,d],events:{click:BX.proxy(this.selectDelivery,this)}}),g&&BX.addClass(e,"bx-selected"),g&&this.result.LAST_ORDER_DATA.PICK_UP&&(this.lastSelectedDelivery=h),e},editFadeDeliveryContent:function(a){var b,c,d,e,f,g=this.getSelectedDelivery(),h="N"!=this.params.SHOW_DELIVERY_PARENT_NAMES?g.NAME:g.OWN_NAME,i=this.deliveryHiddenBlockNode.querySelector("div.alert.alert-danger"),j=this.deliveryHiddenBlockNode.querySelector("div.alert.alert-warning.alert-show");if(i&&i.innerHTML?a.appendChild(i.cloneNode(!0)):this.getErrorContainer(a),j&&j.innerHTML&&a.appendChild(j.cloneNode(!0)),g&&g.NAME){if(c=this.getImageSources(g,"LOGOTIP"),d=c&&c.src_1x||this.defaultDeliveryLogo,e=[BX.create("IMG",{props:{src:d,alt:""},style:{height:"18px"}}),BX.create("SPAN",{text:h})],"Y"==this.params.DELIVERY_FADE_EXTRA_SERVICES&&BX.util.object_keys(g.EXTRA_SERVICES).length){e.push(BX.create("BR"));for(f in g.EXTRA_SERVICES)g.EXTRA_SERVICES.hasOwnProperty(f)&&(b=g.EXTRA_SERVICES[f],b.value&&"N"!=b.value&&b.canUserEditValue&&(e.push(BX.create("BR")),e.push(BX.create("STRONG",{text:b.name+": "})),e.push(b.viewControl)))}a.appendChild(BX.create("DIV",{props:{className:"col-sm-9 bx-soa-pp-company-selected"},children:e})),a.appendChild(BX.create("DIV",{props:{className:"col-sm-3 bx-soa-pp-price"},children:this.getDeliveryPriceNodes(g)}))}else a.appendChild(BX.create("STRONG",{text:BX.message("SOA_DELIVERY_SELECT_ERROR")}));a.appendChild(BX.create("DIV",{style:{clear:"both"}})),BX.bind(a.querySelector(".alert.alert-danger"),"click",BX.proxy(this.showByClick,this)),BX.bind(a.querySelector(".alert.alert-warning"),"click",BX.proxy(this.showByClick,this))},selectDelivery:function(a){if(this.orderBlockNode){var b,c,d=a.target||a.srcElement,e=BX.hasClass(d,"bx-soa-pp-company")?d:BX.findParent(d,{className:"bx-soa-pp-company"}),f=this.deliveryBlockNode.querySelector(".bx-soa-pp-company.bx-selected");if(BX.hasClass(e,"bx-selected"))return BX.PreventDefault(a);e&&(b=e.querySelector("input[type=checkbox]"),BX.addClass(e,"bx-selected"),b.checked=!0),f&&(c=f.querySelector("input[type=checkbox]"),BX.removeClass(f,"bx-selected"),c.checked=!1),this.sendRequest()}},getSelectedDelivery:function(){var a,b,c=this.deliveryBlockNode.querySelector("input[type=checkbox][name=DELIVERY_ID]:checked"),d=!1;if(c||(c=this.deliveryHiddenBlockNode.querySelector("input[type=checkbox][name=DELIVERY_ID]:checked")),c||(c=this.deliveryHiddenBlockNode.querySelector("input[type=hidden][name=DELIVERY_ID]")),c){a=c.value;for(b in this.result.DELIVERY)if(this.result.DELIVERY[b].ID==a){d=this.result.DELIVERY[b];break}}return d},activatePickUp:function(a){this.pickUpBlockNode&&this.pickUpHiddenBlockNode&&(this.pickUpBlockNode.style.display="",this.pickUpBlockNode.querySelector("h2.bx-soa-section-title").innerHTML='<span class="bx-soa-section-title-count"></span>'+a,BX.hasClass(this.pickUpBlockNode,"bx-active")||(BX.addClass(this.pickUpBlockNode,"bx-active"),this.pickUpBlockNode.style.display=""))},deactivatePickUp:function(){this.pickUpBlockNode&&this.pickUpHiddenBlockNode&&BX.hasClass(this.pickUpBlockNode,"bx-active")&&(BX.removeClass(this.pickUpBlockNode,"bx-active"),this.pickUpBlockNode.style.display="none")},editPickUpBlock:function(a){this.pickUpBlockNode&&this.pickUpHiddenBlockNode&&BX.hasClass(this.pickUpBlockNode,"bx-active")&&this.result.DELIVERY&&(this.initialized.pickup=!1,a?this.editActivePickUpBlock(!0):this.editFadePickUpBlock(),this.initialized.pickup=!0)},editActivePickUpBlock:function(a){var b,c,d,e=a?this.pickUpBlockNode:this.pickUpHiddenBlockNode;this.initialized.pickup?(BX.remove(BX.lastChild(e)),e.appendChild(BX.firstChild(this.pickUpHiddenBlockNode)),"Y"!=this.params.SHOW_NEAREST_PICKUP||this.maxWaitTimeExpired||(this.maxWaitTimeExpired=!0,this.initPickUpPagination(),this.editPickUpList(!0),this.pickUpFinalAction()),setTimeout(BX.proxy(function(){var a,b,c;this.pickUpMap&&this.pickUpMap.geoObjects&&(a=this.pickUpMap.geoObjects.getBounds())&&a.length&&(b=a[1][0]-a[0][0],c=a[1][1]-a[0][1],a[0][0]-=b/10,a[0][1]-=c/10,a[1][0]+=b/10,a[1][1]+=c/10,this.pickUpMapInitialized||(this.pickUpMap.setBounds(a,{checkZoomRange:!0}),this.pickUpMapInitialized=!0))},this),200)):(b=e.querySelector(".bx-soa-section-content"),b||(b=this.getNewContainer(),e.appendChild(b)),BX.cleanNode(b),c=BX.create("DIV",{props:{className:"col-xs-12"}}),d=BX.create("DIV",{props:{className:"bx_soa_pickup row"},children:[c]}),this.editPickUpMap(c),b.appendChild(d),"Y"!=this.params.SHOW_NEAREST_PICKUP&&(this.initPickUpPagination(),this.editPickUpList(!0),this.pickUpFinalAction()),this.getBlockFooter(b))},editFadePickUpBlock:function(){var a,b=this.pickUpBlockNode.querySelector(".bx-soa-section-content");this.initialized.pickup?this.pickUpHiddenBlockNode.appendChild(b):(this.editActivePickUpBlock(!1),BX.remove(BX.lastChild(this.pickUpBlockNode))),a=this.getNewContainer(),this.pickUpBlockNode.appendChild(a),this.editFadePickUpContent(a)},editFadePickUpContent:function(a){var b,c,d=this.getSelectedPickUp(),e="";d&&("Y"==this.params.SHOW_STORES_IMAGES&&(b=this.getImageSources(d,"IMAGE_ID"),c=b.src_1x||this.defaultStoreLogo,e+='<img src="'+c+'" class="bx-soa-pickup-preview-img">'),e+="<strong>"+BX.util.htmlspecialchars(d.TITLE)+"</strong>",d.ADDRESS&&(e+="<br /><strong>"+BX.message("SOA_PICKUP_ADDRESS")+":</strong> "+BX.util.htmlspecialchars(d.ADDRESS)),d.PHONE&&(e+="<br /><strong>"+BX.message("SOA_PICKUP_PHONE")+":</strong> "+BX.util.htmlspecialchars(d.PHONE)),
d.SCHEDULE&&(e+="<br /><strong>"+BX.message("SOA_PICKUP_WORK")+":</strong> "+BX.util.htmlspecialchars(d.SCHEDULE)),d.DESCRIPTION&&(e+="<br /><strong>"+BX.message("SOA_PICKUP_DESC")+":</strong> "+BX.util.htmlspecialchars(d.DESCRIPTION)),a.innerHTML=e)},getPickUpInfoArray:function(a){if(!a||a.length<=0)return[];var b,c=[];for(b=0;b<a.length;b++)this.result.STORE_LIST[a[b]]&&c.push(this.result.STORE_LIST[a[b]]);return c},getSelectedPickUp:function(){var a,b,c,d,e=BX("BUYER_STORE"),f=this.result.STORE_LIST;if(e&&(b=e.value,!(a=f[b])&&(c=this.getSelectedDelivery().STORE)))for(d in c)if(c.hasOwnProperty(d)){a=f[c[d]],e.setAttribute("value",c[d]);break}return a},checkPickUpShow:function(){var a,b,c=this.getSelectedDelivery();c&&c.STORE&&c.STORE.length&&(b=this.getPickUpInfoArray(c.STORE)),b&&b.length?(a="N"!=this.params.SHOW_DELIVERY_PARENT_NAMES?c.NAME:c.OWN_NAME,c.STORE_MAIN=c.STORE,this.activatePickUp(a),this.editSection(this.pickUpBlockNode)):this.deactivatePickUp()},geoLocationSuccessCallback:function(a,b){var c;a.geoObjects.options.set("preset","islands#darkGreenCircleDotIcon"),this.pickUpMap.geoObjects.add(a.geoObjects),b&&b.STORE&&(c=this.getPickUpInfoArray(b.STORE)),c.length>=this.options.pickUpMap.minToShowNearestBlock&&this.editPickUpRecommendList(a.geoObjects.get(0)),this.initPickUpPagination(),this.editPickUpList(!0),this.pickUpFinalAction()},initMaps:function(){this.mapsReady=!0;var a,b,c,d,e,f,g,h,i,j=this,k=this.getSelectedDelivery(),l=BX("BUYER_STORE");if(this.resizeMapContainers(),k&&k.STORE&&k.STORE.length&&(i=this.getPickUpInfoArray(k.STORE)),i&&i.length)for(a=this.options.pickUpMap.defaultMapPosition,this.pickUpMap=new ymaps.Map("pickUpMap",{center:[a.lat,a.lon],zoom:a.zoom}),this.pickUpMap.behaviors.disable("scrollZoom"),this.pickUpMap.events.add("click",BX.proxy(function(){this.pickUpMap.balloon.isOpen()&&this.pickUpMap.balloon.close()},this)),"Y"==this.params.SHOW_NEAREST_PICKUP&&(b=ymaps.geolocation,c=this.options.pickUpMap.secureGeoLocation&&BX.browser.IsChrome()&&!this.isHttps?"yandex":"auto",d=this.options.pickUpMap.geoLocationMaxTime||5e3,b.get({provider:c,timeOut:d}).then(BX.proxy(function(a){this.maxWaitTimeExpired||(this.maxWaitTimeExpired=!0,this.geoLocationSuccessCallback(a,k))},this),BX.proxy(function(){this.maxWaitTimeExpired||(this.maxWaitTimeExpired=!0,this.initPickUpPagination(),this.editPickUpList(!0),this.pickUpFinalAction())},this))),this.pickUpPointsJSON=[],e=0;e<i.length;e++)f=this.getStoreInfoHtml(i[e]),this.pickUpPointsJSON.push({type:"Feature",geometry:{type:"Point",coordinates:[i[e].GPS_N,i[e].GPS_S]},properties:{storeId:i[e].ID}}),g=new ymaps.Placemark([i[e].GPS_N,i[e].GPS_S],{hintContent:BX.util.htmlspecialchars(i[e].TITLE)+"<br />"+BX.util.htmlspecialchars(i[e].ADDRESS),storeTitle:i[e].TITLE,storeBody:f,id:i[e].ID,text:this.params.MESS_SELECT_PICKUP},{balloonContentLayout:ymaps.templateLayoutFactory.createClass('<h3>{{ properties.storeTitle }}</h3>{{ properties.storeBody|raw }}<br /><a class="btn btn-sm btn-default" data-store="{{ properties.id }}">{{ properties.text }}</a>',{build:function(){this.constructor.superclass.build.call(this);var a=document.querySelector("a[data-store]");a&&BX.bind(a,"click",this.selectStoreByClick)},clear:function(){var a=document.querySelector("a[data-store]");a&&BX.unbind(a,"click",this.selectStoreByClick),this.constructor.superclass.clear.call(this)},selectStoreByClick:function(a){var b=a.target||a.srcElement;BX.Sale.OrderAjaxComponent.pickUpMap.container.isFullscreen()&&BX.Sale.OrderAjaxComponent.pickUpMap.container.exitFullscreen(),j.selectStore(b.getAttribute("data-store")),j.clickNextAction(a),j.pickUpMap.balloon.close()}})}),l.value==i[e].ID&&g.options.set("preset","islands#redDotIcon"),this.pickUpMap.geoObjects.add(g);"Y"==this.params.SHOW_MAP_IN_PROPS&&BX("propsMap")&&(h=this.options.propertyMap.defaultMapPosition,this.propsMap=new ymaps.Map("propsMap",{center:[h.lat,h.lon],zoom:h.zoom}),this.propsMap.behaviors.disable("scrollZoom"),this.propsMap.events.add("click",BX.proxy(function(a){var b,c=a.get("coords");0==this.propsMap.geoObjects.getLength()?(b=new ymaps.Placemark([c[0],c[1]],{},{draggable:!0,preset:"islands#redDotIcon"}),b.events.add(["parentchange","geometrychange"],function(){var a,c,d,e,f=BX("orderDescription"),g=b.geometry.getCoordinates();f&&(a=f.value.indexOf(BX.message("SOA_MAP_COORDS")+":"),-1==a?f.value=BX.message("SOA_MAP_COORDS")+": "+g[0]+", "+g[1]+"\r\n"+f.value:(e=BX.message("SOA_MAP_COORDS")+": "+g[0]+", "+g[1],c=f.value.substring(0,a),d=f.value.substring(a+e.length),f.value=c+e+d))}),this.propsMap.geoObjects.add(b)):this.propsMap.geoObjects.get(0).geometry.setCoordinates([c[0],c[1]])},this)))},resizeMapContainers:function(){var a,b,c=BX("pickUpMap"),d=BX("propsMap"),e=this.propsBlockNode;e&&(c||d)&&(a=e.clientWidth,b=parseInt(a/16*9),c&&(c.style.height=b+"px"),d&&(d.style.height=b+"px"))},editPickUpMap:function(a){a.appendChild(BX.create("DIV",{props:{id:"pickUpMap"},style:{width:"100%",marginBottom:"10px"}}))},editPickUpList:function(a){if(this.pickUpPagination.currentPage&&this.pickUpPagination.currentPage.length){var b,c,d,e,f,g,h,i=BX.create("DIV",{props:{className:"bx-soa-pickup-list main"}}),j=BX("BUYER_STORE"),k=!1;if(j&&(b=j.value),e=this.pickUpBlockNode.querySelector(".bx-soa-pickup-list.recommend"),e||(e=this.pickUpHiddenBlockNode.querySelector(".bx-soa-pickup-list.recommend")),e&&e.querySelector(".bx-soa-pickup-list-item.bx-selected"))k=!0;else if((f=this.getSelectedDelivery())&&f.STORE)for(d=0;d<f.STORE.length;d++)f.STORE[d]==b&&(k=!0);for(d=0;d<this.pickUpPagination.currentPage.length;d++)g=this.pickUpPagination.currentPage[d],g.ID!=b&&0!=parseInt(b)&&k||(b=j.value=g.ID,k=!0),h=this.createPickUpItem(g,{selected:g.ID==b}),i.appendChild(h);a?(c=this.pickUpHiddenBlockNode.querySelector(".bx_soa_pickup>.col-xs-12"),c||(c=this.pickUpBlockNode.querySelector(".bx_soa_pickup>.col-xs-12")),c.appendChild(BX.create("DIV",{props:{className:"bx-soa-pickup-subTitle"},text:this.params.MESS_PICKUP_LIST})),c.appendChild(i)):(c=this.pickUpBlockNode.querySelector(".bx-soa-pickup-list.main"),BX.insertAfter(i,c),BX.remove(c)),this.pickUpPagination.show&&this.showPagination("pickUp",i)}},pickUpFinalAction:function(){var a,b=this.getSelectedDelivery(),c=BX("BUYER_STORE");b&&(a=this.lastSelectedDelivery!==parseInt(b.ID),this.lastSelectedDelivery=parseInt(b.ID)),a&&this.pickUpBlockNode.id!==this.activeSectionId&&this.editFadePickUpContent(BX.lastChild(this.pickUpBlockNode)),a&&BX.removeClass(this.pickUpBlockNode,"bx-step-completed"),this.pickUpMap&&this.pickUpMap.geoObjects&&this.pickUpMap.geoObjects.each(function(a){a.properties.get("id")==c.value?a.options.set({preset:"islands#redDotIcon"}):parseInt(a.properties.get("id"))>0&&a.options.unset("preset")})},getStoreInfoHtml:function(a){var b="";return a.ADDRESS&&(b+=BX.message("SOA_PICKUP_ADDRESS")+": "+BX.util.htmlspecialchars(a.ADDRESS)+"<br />"),a.PHONE&&(b+=BX.message("SOA_PICKUP_PHONE")+": "+BX.util.htmlspecialchars(a.PHONE)+"<br />"),a.SCHEDULE&&(b+=BX.message("SOA_PICKUP_WORK")+": "+BX.util.htmlspecialchars(a.SCHEDULE)+"<br />"),a.DESCRIPTION&&(b+=BX.message("SOA_PICKUP_DESC")+": "+BX.util.htmlspecialchars(a.DESCRIPTION)+"<br />"),b},createPickUpItem:function(a,b){b=b||{};var c,d,e,f,g="bx-soa-pickup-l-item-detail",h="bx-soa-pickup-l-item-btn";return"Y"==this.params.SHOW_STORES_IMAGES?(d=this.getImageSources(a,"IMAGE_ID"),c=BX.create("IMG",{props:{src:d&&d.src_1x||this.defaultStoreLogo,className:"bx-soa-pickup-l-item-img"}})):(g+=" no-image",h+=" no-image"),e=this.getStoreInfoHtml(a),f=BX.create("DIV",{props:{className:"bx-soa-pickup-list-item",id:"store-"+a.ID},children:[BX.create("DIV",{props:{className:"bx-soa-pickup-l-item-adress"},children:b.distance?[BX.util.htmlspecialchars(a.ADDRESS)," ( ~"+b.distance+" "+BX.message("SOA_DISTANCE_KM")+" ) "]:[BX.util.htmlspecialchars(a.ADDRESS)]}),BX.create("DIV",{props:{className:g},children:[c,BX.create("DIV",{props:{className:"bx-soa-pickup-l-item-name"},text:a.TITLE}),BX.create("DIV",{props:{className:"bx-soa-pickup-l-item-desc"},html:e})]}),BX.create("DIV",{props:{className:h},children:[BX.create("A",{props:{href:"",className:"btn btn-sm btn-default"},text:this.params.MESS_SELECT_PICKUP,events:{click:BX.proxy(function(a){this.selectStore(a),this.clickNextAction(a)},this)}})]})],events:{click:BX.proxy(this.selectStore,this)}}),b.selected&&BX.addClass(f,"bx-selected"),f},editPickUpRecommendList:function(a){if(this.pickUpPointsJSON&&this.pickUpPointsJSON.length&&a){var b,c,d,e,f,g,h,i,j=BX.create("DIV",{props:{className:"bx-soa-pickup-list recommend"}}),k=BX("BUYER_STORE"),l=this.getSelectedDelivery(),m=this.pickUpPointsJSON.length<this.options.pickUpMap.nearestPickUpsToShow?this.pickUpPointsJSON.length:this.options.pickUpMap.nearestPickUpsToShow;for(b=0;b<m;b++)c=ymaps.geoQuery({type:"FeatureCollection",features:this.pickUpPointsJSON}),d=c.getClosestTo(a),e=d.properties.get("storeId"),f=this.getPickUpInfoArray([e])[0],0==b&&parseInt(l.ID)!==this.lastSelectedDelivery&&(k.value=parseInt(f.ID)),g=ymaps.coordSystem.geo.getDistance(a.geometry.getCoordinates(),d.geometry.getCoordinates()),g=Math.round(g/100)/10,h=this.createPickUpItem(f,{selected:k.value==f.ID,distance:g}),j.appendChild(h),l.STORE_MAIN.splice(l.STORE_MAIN.indexOf(e),1),this.pickUpPointsJSON.splice(c.indexOf(d),1);i=this.pickUpHiddenBlockNode.querySelector(".bx_soa_pickup>.col-xs-12"),i||(i=this.pickUpBlockNode.querySelector(".bx_soa_pickup>.col-xs-12")),i.appendChild(BX.create("DIV",{props:{className:"bx-soa-pickup-subTitle"},text:this.params.MESS_NEAREST_PICKUP_LIST})),i.appendChild(j)}},selectStore:function(a){var b,c,d,e,f,g,h,i,j,k=BX("BUYER_STORE");if(BX.type.isString(a)){if(!(b=BX("store-"+a))){for(e=0;e<this.pickUpPagination.pages.length;e++)for(g=this.pickUpPagination.pages[e],f=0;f<g.length;f++)if(g[f].ID==a){this.showPickUpItemsPage(++e);break}b=BX("store-"+a)}}else h=a.target||a.srcElement,b=BX.hasClass(h,"bx-soa-pickup-list-item")?h:BX.findParent(h,{className:"bx-soa-pickup-list-item"});if(b&&k){if(BX.hasClass(b,"bx-selected"))return;c=this.pickUpBlockNode.querySelector(".bx-selected"),d=b.id.substr("store-".length),BX.removeClass(c,"bx-selected"),i=b.clientHeight,b.style.overflow="hidden",BX.addClass(b,"bx-selected"),j=b.clientHeight,b.style.height=i+"px",new BX.easing({duration:300,start:{height:i,opacity:0},finish:{height:j,opacity:100},transition:BX.easing.transitions.quad,step:function(a){b.style.height=a.height+"px"},complete:function(){b.removeAttribute("style")}}).animate(),k.setAttribute("value",d),this.pickUpMap&&this.pickUpMap.geoObjects&&this.pickUpMap.geoObjects.each(BX.proxy(function(a){a.properties.get("id")&&a.options.unset("preset"),a.properties.get("id")==d&&(a.options.set({preset:"islands#redDotIcon"}),this.pickUpMap.panTo([a.geometry.getCoordinates()]))},this))}},getDeliverySortedArray:function(a){var b,c=[];for(b in a)a.hasOwnProperty(b)&&c.push(a[b]);return c.sort(function(a,b){var c=parseInt(a.SORT)-parseInt(b.SORT);return 0===c?a.OWN_NAME.toLowerCase()>b.OWN_NAME.toLowerCase()?1:a.OWN_NAME.toLowerCase()<b.OWN_NAME.toLowerCase()?-1:0:c}),c},editPropsBlock:function(a){this.propsBlockNode&&this.propsHiddenBlockNode&&this.result.ORDER_PROP&&(a?this.editActivePropsBlock(!0):this.editFadePropsBlock(),this.initialized.props=!0)},editActivePropsBlock:function(a){var b,c,d,e,f,g=a?this.propsBlockNode:this.propsHiddenBlockNode,h=!1;if(this.initialized.props)BX.remove(BX.lastChild(g)),g.appendChild(BX.firstChild(this.propsHiddenBlockNode));else{if(b=g.querySelector(".bx-soa-section-content"),b?BX.cleanNode(b):(b=this.getNewContainer(),g.appendChild(b)),this.getErrorContainer(b),c=BX.create("DIV",{props:{className:"row"}}),(d=this.getSelectedDelivery())&&"Y"==this.params.SHOW_MAP_IN_PROPS&&this.params.SHOW_MAP_FOR_DELIVERIES&&this.params.SHOW_MAP_FOR_DELIVERIES.length)for(e=0;e<this.params.SHOW_MAP_FOR_DELIVERIES.length;e++)if(parseInt(d.ID)==parseInt(this.params.SHOW_MAP_FOR_DELIVERIES[e])){h=!0;break}this.editPropsItems(c),h&&this.editPropsMap(c),this.editPropsComment(c),b.appendChild(c),this.getBlockFooter(b),"true"==this.propsBlockNode.getAttribute("data-visited")&&(f=this.isValidPropertiesBlock(!0),f.length?BX.addClass(this.propsBlockNode,"bx-step-error"):BX.removeClass(this.propsBlockNode,"bx-step-error"))}},editFadePropsBlock:function(){var a,b=this.propsBlockNode.querySelector(".bx-soa-section-content");this.initialized.props?this.propsHiddenBlockNode.appendChild(b):(this.editActivePropsBlock(!1),BX.remove(BX.lastChild(this.propsBlockNode))),a=this.getNewContainer(),this.propsBlockNode.appendChild(a),this.editFadePropsContent(a)},editFadePropsContent:function(a){if(a&&this.locationsInitialized){var b,c,d,e,f,g,h,i,j=this.propsHiddenBlockNode.querySelector(".alert"),k=this.getSelectedPersonType();if(BX.cleanNode(a),j&&a.appendChild(j.cloneNode(!0)),k&&(b="PROPS_FADE_LIST_"+k.ID,c=this.params[b]),c&&0!=c.length)for(f=this.fadedPropertyCollection.getGroupIterator();d=f();)for(g=d.getIterator();e=g();)for(h=0;h<c.length;h++)c[h]==e.getId()&&"Y"!=e.getSettings().IS_ZIP&&this.getPropertyRowNode(e,a,!0);else a.innerHTML+="<span>"+BX.message("SOA_ORDER_PROPS")+"</span>";"true"==this.propsBlockNode.getAttribute("data-visited")&&(i=this.isValidPropertiesBlock(),i.length&&this.showError(this.propsBlockNode,i)),BX.bind(a.querySelector(".alert.alert-danger"),"click",BX.proxy(this.showByClick,this)),BX.bind(a.querySelector(".alert.alert-warning"),"click",BX.proxy(this.showByClick,this))}},editPropsItems:function(a){if(this.result.ORDER_PROP&&this.propertyCollection){var b,c,d,e=BX.create("DIV",{props:{className:"col-sm-12 bx-soa-customer"}}),f=this.propertyCollection.getGroupIterator();for(e||(e=this.propsBlockNode.querySelector(".col-sm-12.bx-soa-customer"));b=f();)for(d=b.getIterator();c=d();)this.deliveryLocationInfo.loc!=c.getId()&&this.deliveryLocationInfo.zip!=c.getId()&&this.deliveryLocationInfo.city!=c.getId()&&this.getPropertyRowNode(c,e,!1);a.appendChild(e)}},getPropertyRowNode:function(a,b,c){var d,e=BX.create("DIV"),f="",g=a.getType()||"",h=a.getDescription()||"";switch(c?e.innerHTML="<strong>"+BX.util.htmlspecialchars(a.getName())+":</strong> ":(BX.addClass(e,"form-group bx-soa-customer-field"),a.isRequired()&&(f+='<span class="bx-authform-starrequired">*</span> '),f+=BX.util.htmlspecialchars(a.getName()),h.length&&"STRING"!=g&&"NUMBER"!=g&&"DATE"!=g&&(f+=" <small>("+BX.util.htmlspecialchars(h)+")</small>"),d=BX.create("LABEL",{attrs:{for:"soa-property-"+a.getId()},props:{className:"bx-soa-custom-label"},html:f}),e.setAttribute("data-property-id-row",a.getId()),e.appendChild(d)),g){case"LOCATION":this.insertLocationProperty(a,e,c);break;case"DATE":this.insertDateProperty(a,e,c);break;case"FILE":this.insertFileProperty(a,e,c);break;case"STRING":this.insertStringProperty(a,e,c);break;case"ENUM":this.insertEnumProperty(a,e,c);break;case"Y/N":this.insertYNProperty(a,e,c);break;case"NUMBER":this.insertNumberProperty(a,e,c)}b.appendChild(e)},insertLocationProperty:function(a,b,c){var d,e,f,g,h,i,j,k,l=[];if(a.getId()in this.locations)if(c){if(d=this.propsHiddenBlockNode.querySelector('[data-property-id-row="'+a.getId()+'"]'))for(e=d.querySelectorAll("div.bx-soa-loc"),j=0;j<e.length;j++)f=this.getLocationString(e[j]),l.push(f.length?f:BX.message("SOA_NOT_SELECTED"));b.innerHTML+=l.join("<br />")}else{for(i=BX.create("DIV",{props:{className:"soa-property-container"}}),d=this.locations[a.getId()],j=0;j<d.length;j++){g=d[j]?d[j].output:{},h=BX.create("DIV",{props:{className:"bx-soa-loc"},html:g.HTML}),a.isMultiple()&&(h.style.marginBottom="search"==this.locationsTemplate?"5px":"20px"),i.appendChild(h);for(k in g.SCRIPT)g.SCRIPT.hasOwnProperty(k)&&BX.evalGlobal(g.SCRIPT[k].JS)}a.isMultiple()&&i.appendChild(BX.create("DIV",{attrs:{"data-prop-id":a.getId()},props:{className:"btn btn-sm btn-default"},text:BX.message("ADD_DEFAULT"),events:{click:BX.proxy(this.addLocationProperty,this)}})),b.appendChild(i)}},addLocationProperty:function(a){var b,c,d,e=a.target||a.srcElement,f=e.getAttribute("data-prop-id"),g=BX.previousSibling(e),h=0,i="sls-",j=BX.util.getRandomString(5);if(BX.hasClass(g,"bx-soa-loc")&&("search"==this.locationsTemplate?(d=g.querySelector("input[type=text][class=dropdown-field]"))&&(h=parseInt(d.name.substring(d.name.indexOf("[")+1,d.name.indexOf("]")))+1):(d=g.querySelectorAll("input[type=hidden]"),d.length&&(d=d[d.length-1],h=parseInt(d.name.substring(d.name.indexOf("[")+1,d.name.indexOf("]")))+1))),this.cleanLocations[f]){b=BX.create("DIV",{props:{className:"bx-soa-loc"},style:{marginBottom:"search"==this.locationsTemplate?"5px":"20px"},html:this.cleanLocations[f].HTML.split("#key#").join(h).replace(/sls-\d{5}/g,i+j)}),e.parentNode.insertBefore(b,e),BX.saleOrderAjax.addPropertyDesc({id:f+"_"+h,attributes:{id:f+"_"+h,type:"LOCATION",valueSource:"form"}});for(c in this.cleanLocations[f].SCRIPT)this.cleanLocations[f].SCRIPT.hasOwnProperty(c)&&BX.evalGlobal(this.cleanLocations[f].SCRIPT[c].JS.split("_key__").join("_"+h).replace(/sls-\d{5}/g,i+j));BX.saleOrderAjax.initDeferredControl()}},insertDateProperty:function(a,b,c){var d,e,f,g,h,i;if(c){if(d=this.propsHiddenBlockNode.querySelector('div[data-property-id-row="'+a.getId()+'"]')){for(f=[],e=d.querySelectorAll("input[type=text]"),g=0;g<e.length;g++)e[g].value&&e[g].value.length&&f.push(e[g].value);b.innerHTML+=this.valuesToString(f)}}else{for(h=BX.create("DIV",{props:{className:"soa-property-container"}}),a.appendTo(h),b.appendChild(h),i=h.querySelectorAll("input[type=text]"),g=0;g<i.length;g++)this.alterDateProperty(a.getSettings(),i[g]);this.alterProperty(a.getSettings(),h)}},insertFileProperty:function(a,b,c){var d,e,f,g,h,i,j;if(c){if(d=this.propsHiddenBlockNode.querySelector('div[data-property-id-row="'+a.getId()+'"]')){for(f=[],e=d.querySelectorAll("a"),g=0;g<e.length;g++)h=e[g].innerHTML,h.length&&f.push(h);b.innerHTML+=this.valuesToString(f)}}else i=this.savedFilesBlockNode.querySelector('div[data-property-id-row="'+a.getId()+'"]'),i&&(j=i.querySelector("div.soa-property-container")),j?b.appendChild(j):(j=BX.create("DIV",{props:{className:"soa-property-container"}}),a.appendTo(j),b.appendChild(j),this.alterProperty(a.getSettings(),j))},insertStringProperty:function(a,b,c){var d,e,f,g,h;if(c){if(d=this.propsHiddenBlockNode.querySelector('div[data-property-id-row="'+a.getId()+'"]')){if(f=[],e=d.querySelectorAll("input[type=text]"),0==e.length&&(e=d.querySelectorAll("textarea")),e.length)for(g=0;g<e.length;g++)e[g].value.length&&f.push(e[g].value);b.innerHTML+=this.valuesToString(f)}}else h=BX.create("DIV",{props:{className:"soa-property-container"}}),a.appendTo(h),b.appendChild(h),this.alterProperty(a.getSettings(),h),this.bindValidation(a.getId(),h)},insertEnumProperty:function(a,b,c){var d,e,f,g,h;if(c){if(d=this.propsHiddenBlockNode.querySelector('div[data-property-id-row="'+a.getId()+'"]')){if(f=[],e=d.querySelectorAll("input[type=radio]"),e.length)for(g=0;g<e.length;g++)e[g].checked&&f.push(e[g].nextSibling.nodeValue);if(e=d.querySelectorAll("option"),e.length)for(g=0;g<e.length;g++)e[g].selected&&f.push(e[g].innerHTML);b.innerHTML+=this.valuesToString(f)}}else h=BX.create("DIV",{props:{className:"soa-property-container"}}),a.appendTo(h),b.appendChild(h),this.bindValidation(a.getId(),h)},insertYNProperty:function(a,b,c){var d,e,f,g,h;if(c){if(d=this.propsHiddenBlockNode.querySelector('div[data-property-id-row="'+a.getId()+'"]')){for(f=[],e=d.querySelectorAll("input[type=checkbox]"),g=0;g<e.length;g+=2)f.push(e[g].checked?BX.message("SOA_YES"):BX.message("SOA_NO"));b.innerHTML+=this.valuesToString(f)}}else h=BX.create("DIV",{props:{className:"soa-property-container"}}),a.appendTo(h),b.appendChild(h),this.alterProperty(a.getSettings(),h),this.bindValidation(a.getId(),h)},insertNumberProperty:function(a,b,c){var d,e,f,g,h;if(c){if(d=this.propsHiddenBlockNode.querySelector('div[data-property-id-row="'+a.getId()+'"]')){for(f=[],e=d.querySelectorAll("input[type=text]"),g=0;g<e.length;g++)e[g].value.length&&f.push(e[g].value);b.innerHTML+=this.valuesToString(f)}}else h=BX.create("DIV",{props:{className:"soa-property-container"}}),a.appendTo(h),b.appendChild(h),this.alterProperty(a.getSettings(),h),this.bindValidation(a.getId(),h)},valuesToString:function(a){var b=a.join(", ");return b.length?b:BX.message("SOA_NOT_SELECTED")},alterProperty:function(a,b){var c,d,e,f,g,h,i,j,k=BX.findChildren(b,{tagName:"DIV"});for(c=0;c<k.length;c++)k[c].style.margin="5px 0";for(d=b.querySelector("input[type=text]"),d||(d=b.querySelector("textarea")),d&&(d.id="soa-property-"+a.ID,"Y"==a.IS_ADDRESS&&d.setAttribute("autocomplete","address"),"Y"==a.IS_EMAIL&&d.setAttribute("autocomplete","email"),"Y"==a.IS_PAYER&&d.setAttribute("autocomplete","name"),"Y"==a.IS_PHONE&&d.setAttribute("autocomplete","tel")),e=b.querySelectorAll("input[type=text]"),c=0;c<e.length;c++)e[c].placeholder=a.DESCRIPTION,BX.addClass(e[c],"form-control bx-soa-customer-input bx-ios-fix");for(e=b.querySelectorAll("select"),c=0;c<e.length;c++)BX.addClass(e[c],"form-control");for(e=b.querySelectorAll("textarea"),c=0;c<e.length;c++)e[c].placeholder=a.DESCRIPTION,BX.addClass(e[c],"form-control bx-ios-fix");for(f=b.querySelectorAll("label"),c=0;c<f.length;c++)BX.remove(f[c]);if("FILE"==a.TYPE){if(a.ACCEPT.length)for(h=b.querySelectorAll("input[type=file]"),i=this.getFileAccepts(a.ACCEPT),c=0;c<h.length;c++)h[c].setAttribute("accept",i);for(j=b.querySelectorAll("a"),c=0;c<j.length;c++)BX.bind(j[c],"click",function(a){var b=a.target||a.srcElement,c=b&&b.nextSibling&&b.nextSibling.nextSibling;c&&BX.fireEvent(c,"change")})}for(g=b.querySelectorAll("input[type=button]"),c=0;c<g.length;c++)BX.addClass(g[c],"btn btn-default btn-sm"),"Y"==a.MULTIPLE&&c==g.length-1||"FILE"==a.TYPE&&(BX.prepend(g[c],g[c].parentNode),g[c].style.marginRight="10px");g.length&&(g=g[g.length-1],BX.bind(g,"click",BX.proxy(function(c){var d,e,f,g,h=c.target||c.srcElement,i=BX.findParent(h,{tagName:"div",className:"soa-property-container"}),j=i.querySelector("label"),k=i.querySelectorAll("input[type=button]"),l=i.querySelectorAll("input[type=text]"),m=i.querySelectorAll("textarea"),n=BX.findChildren(i,{tagName:"DIV"});for(d=0;d<n.length;d++)n[d].style.margin="5px 0";if(this.bindValidation(a.ID,i),k.length&&k[k.length-2]&&(BX.prepend(k[k.length-2],k[k.length-2].parentNode),k[k.length-2].style.marginRight="10px",BX.addClass(k[k.length-2],"btn btn-default btn-sm")),j&&BX.remove(j),l.length&&(l[l.length-1].placeholder=a.DESCRIPTION,BX.addClass(l[l.length-1],"form-control bx-soa-customer-input bx-ios-fix"),"DATE"==a.TYPE&&this.alterDateProperty(a,l[l.length-1])),m.length&&(m[m.length-1].placeholder=a.DESCRIPTION,BX.addClass(m[m.length-1],"form-control bx-ios-fix")),"FILE"==a.TYPE){if(a.ACCEPT.length)for(f=b.querySelectorAll("input[type=file]"),g=this.getFileAccepts(a.ACCEPT),d=0;d<f.length;d++)f[d].setAttribute("accept",g);e=i.querySelectorAll("a"),BX.bind(e[e.length-1],"click",function(a){var b=a.target||a.srcElement,c=b&&b.nextSibling&&b.nextSibling.nextSibling;c&&setTimeout(function(){BX.fireEvent(c,"change")},10)})}},this)))},alterDateProperty:function(a,b){var c,d=BX.findParent(b,{tagName:"DIV"});BX.addClass(d,"input-group"),c=BX.create("DIV",{props:{className:"input-group-addon"},children:[BX.create("I",{props:{className:"bx-calendar"}})]}),BX.insertAfter(c,b),BX.remove(d.querySelector("input[type=button]")),BX.bind(c,"click",BX.delegate(function(b){var c=b.target||b.srcElement,d=BX.findParent(c,{tagName:"DIV",className:"input-group"});BX.calendar({node:d.querySelector(".input-group-addon"),field:d.querySelector("input[type=text]").name,form:"",bTime:"Y"==a.TIME,bHideTime:!1})},this))},isValidForm:function(){if(!this.options.propertyValidation)return!0;var a,b,c=this.isValidRegionBlock(),d=this.isValidPropertiesBlock(),e=!1;if(c.length&&(e=!0,this.animateScrollTo(this.regionBlockNode,800,50)),d.length&&!e)if(this.activeSectionId==this.propsBlockNode.id){for(a=this.propsBlockNode.querySelectorAll("div.tooltip"),b=0;b<a.length;b++)if("opened"==a[b].getAttribute("data-state")){this.animateScrollTo(BX.findParent(a[b],{className:"form-group bx-soa-customer-field"}),800,50);break}}else this.animateScrollTo(this.propsBlockNode,800,50);return c.length&&(this.showError(this.regionBlockNode,c),BX.addClass(this.regionBlockNode,"bx-step-error")),d.length&&(this.activeSectionId!==this.propsBlockNode.id&&this.showError(this.propsBlockNode,d),BX.addClass(this.propsBlockNode,"bx-step-error")),!(c.length+d.length)},isValidRegionBlock:function(){if(!this.options.propertyValidation)return[];var a,b,c,d,e=this.orderBlockNode.querySelectorAll(".bx-soa-location-input-container[data-property-id-row]"),f=[];for(d=0;d<e.length;d++)a=e[d].getAttribute("data-property-id-row"),b=this.validation.properties[a],c=this.getValidationData(b,e[d]),f=f.concat(this.isValidProperty(c,!0));return f},isValidPropertiesBlock:function(a){if(!this.options.propertyValidation)return[];var b,c,d,e,f,g=this.orderBlockNode.querySelectorAll(".bx-soa-customer-field[data-property-id-row]"),h=[];for(f=0;f<g.length;f++)b=g[f].getAttribute("data-property-id-row"),a&&this.locations[b]||(c=g[f].querySelector(".soa-property-container"))&&(d=this.validation.properties[b],e=this.getValidationData(d,c),h=h.concat(this.isValidProperty(e,!0)));return h},isValidProperty:function(a,b){var c,d,e=[];if(!a||!a.inputs)return e;for(d=0;d<a.inputs.length;d++)c=a.func(a.inputs[d],!!b),c.length&&(e[d]=c.join("<br />"));return this.showValidationResult(a.inputs,e),e},bindValidation:function(a,b){if(this.validation.properties&&this.validation.properties[a]){var c,d,e=this.validation.properties[a],f=this.getValidationData(e,b);if(f&&f.inputs&&f.action)for(c=0;c<f.inputs.length;c++)if(BX.type.isElementNode(f.inputs[c]))BX.bind(f.inputs[c],f.action,BX.proxy(function(){this.isValidProperty(f)},this));else for(d=0;d<f.inputs[c].length;d++)BX.bind(f.inputs[c][d],f.action,BX.proxy(function(){this.isValidProperty(f)},this))}},getValidationData:function(a,b){if(a&&b){var c,d={};switch(a.TYPE){case"STRING":if(d.action="change",d.func=BX.proxy(function(b,c){return this.validateString(b,a,c)},this),c=b.querySelectorAll("input[type=text]"),c.length){d.inputs=c;break}c=b.querySelectorAll("textarea"),c.length&&(d.inputs=c);break;case"LOCATION":if(d.func=BX.proxy(function(b,c){return this.validateLocation(b,a,c)},this),c=b.querySelectorAll("input.bx-ui-sls-fake[type=text]"),c.length){d.inputs=c,d.action="keyup";break}c=b.querySelectorAll("div.bx-ui-slst-pool"),c.length&&(d.inputs=c);break;case"Y/N":d.inputs=b.querySelectorAll("input[type=checkbox]"),d.action="change",d.func=BX.proxy(function(b,c){return this.validateCheckbox(b,a,c)},this);break;case"NUMBER":d.inputs=b.querySelectorAll("input[type=text]"),d.action="blur",d.func=BX.proxy(function(b,c){return this.validateNumber(b,a,c)},this);break;case"ENUM":if(c=b.querySelectorAll("input[type=radio]"),c.length||(c=b.querySelectorAll("input[type=checkbox]")),c.length){d.inputs=[c],d.action="change",d.func=BX.proxy(function(b,c){return this.validateEnum(b,a,c)},this);break}c=b.querySelectorAll("option"),c.length&&(d.inputs=[c],d.action="click",d.func=BX.proxy(function(b,c){return this.validateSelect(b,a,c)},this));break;case"FILE":d.inputs=b.querySelectorAll("input[type=file]"),d.action="change",d.func=BX.proxy(function(b,c){return this.validateFile(b,a,c)},this)}return d}},showErrorTooltip:function(a,b,c){if(a&&b&&c){var d,e,f=BX("tooltip-"+a);c=this.uniqueText(c,"<br />"),f?d=f.querySelector("div.tooltip-inner"):(d=BX.create("DIV",{props:{className:"tooltip-inner"}}),f=BX.create("DIV",{props:{id:"tooltip-"+a,className:"bx-soa-tooltip bx-soa-tooltip-static bx-soa-tooltip-danger tooltip top"},children:[BX.create("DIV",{props:{className:"tooltip-arrow"}}),d]}),e=b.parentNode.querySelector("div.quick-locations"),e&&(b=e),BX.insertAfter(f,b)),d.innerHTML=c,"opened"!=f.getAttribute("data-state")&&(f.setAttribute("data-state","opened"),f.style.opacity=0,f.style.display="block",new BX.easing({duration:150,start:{opacity:0},finish:{opacity:100},transition:BX.easing.transitions.quad,step:function(a){f.style.opacity=a.opacity/100}}).animate())}},closeErrorTooltip:function(a){var b=BX("tooltip-"+a);b&&(b.setAttribute("data-state","closed"),new BX.easing({duration:150,start:{opacity:100},finish:{opacity:0},transition:BX.easing.transitions.quad,step:function(a){b.style.opacity=a.opacity/100},complete:function(){b.style.display="none"}}).animate())},showValidationResult:function(a,b){if(a&&a.length&&b){var c,d,e,f=BX.type.isElementNode(a[0])?a[0]:a[0][0],g=BX.findParent(f,{tagName:"DIV",className:"form-group"}),h=g.querySelector("label");for(h&&(c=h.getAttribute("for")),e=0;e<a.length;e++)d=BX.findParent(a[e],{tagName:"DIV",className:"form-group"}),b[e]&&b[e].length?BX.addClass(d,"has-error"):BX.removeClass(d,"has-error");b.length?this.showErrorTooltip(c,h,b.join("<br />")):this.closeErrorTooltip(c)}},validateString:function(a,b,c){if(!a||!b)return[];var d,e=a.value,f=[],g=BX.util.htmlspecialchars(b.NAME),h=c?BX.message("SOA_FIELD")+' "'+g+'"':BX.message("SOA_FIELD");return"Y"==b.MULTIPLE?f:("Y"==b.REQUIRED&&0==e.length?f.push(h+" "+BX.message("SOA_REQUIRED")):(b.MINLENGTH&&b.MINLENGTH>e.length&&f.push(BX.message("SOA_MIN_LENGTH")+' "'+g+'" '+BX.message("SOA_LESS")+" "+b.MINLENGTH+" "+BX.message("SOA_SYMBOLS")),b.MAXLENGTH&&b.MAXLENGTH<e.length&&f.push(BX.message("SOA_MAX_LENGTH")+' "'+g+'" '+BX.message("SOA_MORE")+" "+b.MAXLENGTH+" "+BX.message("SOA_SYMBOLS")),e.length>0&&"Y"==b.IS_EMAIL&&(d=/^(([^<>()[\]\.,;:\s@\"]+(\.[^<>()[\]\.,;:\s@\"]+)*)|(\".+\"))@(([^<>()[\]\.,;:\s@\"]+\.)+[^<>()[\]\.,;:\s@\"]{2,})$/i,d.test(e)||f.push(BX.message("SOA_INVALID_EMAIL")))),f)},validateLocation:function(a,b,c){if(!a||!b)return[];var d=BX.findParent(a,{tagName:"DIV",className:"form-group"}),e=this.getLocationString(d),f=[],g=c?BX.message("SOA_FIELD")+' "'+BX.util.htmlspecialchars(b.NAME)+'"':BX.message("SOA_FIELD");return"Y"==b.MULTIPLE&&"Y"!==b.IS_LOCATION?f:("Y"!=b.REQUIRED||0!=e.length&&e!=BX.message("SOA_NOT_SPECIFIED")||f.push(g+" "+BX.message("SOA_REQUIRED")),f)},validateCheckbox:function(a,b,c){if(!a||!b)return[];var d=[],e=c?BX.message("SOA_FIELD")+' "'+BX.util.htmlspecialchars(b.NAME)+'"':BX.message("SOA_FIELD");return"Y"==b.MULTIPLE?d:("Y"!=b.REQUIRED||a.checked||d.push(e+" "+BX.message("SOA_REQUIRED")),d)},validateNumber:function(a,b,c){if(!a||!b)return[];var d,e,f=a.value,g=[],h=BX.util.htmlspecialchars(b.NAME),i=c?BX.message("SOA_FIELD")+' "'+h+'"':BX.message("SOA_FIELD");return"Y"==b.MULTIPLE?g:("Y"==b.REQUIRED&&0==f.length&&g.push(i+" "+BX.message("SOA_REQUIRED")),f.length&&(/[0-9]|\./.test(f)||g.push(i+" "+BX.message("SOA_NOT_NUMERIC")),b.MIN&&parseFloat(b.MIN)>parseFloat(f)&&g.push(BX.message("SOA_MIN_VALUE")+' "'+h+'" '+parseFloat(b.MIN)),b.MAX&&parseFloat(b.MAX)<parseFloat(f)&&g.push(BX.message("SOA_MAX_VALUE")+' "'+h+'" '+parseFloat(b.MAX)),b.STEP&&parseFloat(b.STEP)>0&&(d=Math.abs(parseFloat(f)-(b.MIN&&parseFloat(b.MIN)>0?parseFloat(b.MIN):0)),(e=(d/parseFloat(b.STEP)).toPrecision(12))!=parseInt(e)&&g.push(i+" "+BX.message("SOA_NUM_STEP")+" "+b.STEP))),g)},validateEnum:function(a,b,c){if(!a||!b)return[];var d,e=[],f=[],g=c?BX.message("SOA_FIELD")+' "'+BX.util.htmlspecialchars(b.NAME)+'"':BX.message("SOA_FIELD");if("Y"==b.MULTIPLE)return f;for(d=0;d<a.length;d++)(a[d].checked||a[d].selected)&&e.push(d);return"Y"==b.REQUIRED&&0==e.length&&f.push(g+" "+BX.message("SOA_REQUIRED")),f},validateSelect:function(a,b,c){if(!a||!b)return[];var d,e=[],f=[],g=c?BX.message("SOA_FIELD")+' "'+BX.util.htmlspecialchars(b.NAME)+'"':BX.message("SOA_FIELD");if("Y"==b.MULTIPLE)return f;for(d=0;d<a.length;d++)a[d].selected&&e.push(d);return"Y"==b.REQUIRED&&0==e.length&&f.push(g+" "+BX.message("SOA_REQUIRED")),f},validateFile:function(a,b,c){if(!a||!b)return[]
;var d,e,f,g,h,i=[],j=a.files||[],k=c?BX.message("SOA_FIELD")+' "'+BX.util.htmlspecialchars(b.NAME)+'"':BX.message("SOA_FIELD"),l=a.previousSibling.value;if("Y"==b.MULTIPLE)return i;if("Y"!=b.REQUIRED||0!=j.length||""!=l||b.DEFAULT_VALUE.length)for(d=0;d<j.length;d++)e=j[d],f=BX.util.htmlspecialchars(e.name),g=e.name.split("."),h=g.length>1?g[g.length-1].toLowerCase():"",b.ACCEPT.length>0&&(0==h.length||"-1"==b.ACCEPT.indexOf(h))&&i.push(BX.message("SOA_BAD_EXTENSION")+' "'+f+'" ('+BX.util.htmlspecialchars(b.ACCEPT)+")"),e.size>parseInt(b.MAXSIZE)&&i.push(BX.message("SOA_MAX_SIZE")+' "'+f+'" ('+this.getSizeString(b.MAXSIZE,1)+")");else i.push(k+" "+BX.message("SOA_REQUIRED"));return i},editPropsMap:function(a){var b=BX.create("DIV",{props:{className:"col-sm-12"},style:{marginBottom:"10px"}}),c=BX.create("DIV",{props:{id:"propsMap"},style:{width:"100%"}});b.appendChild(c),a.appendChild(b)},editPropsComment:function(a){var b,c,d,e;b=BX.create("DIV",{props:{className:"col-sm-12"}}),c=BX.create("LABEL",{attrs:{for:"orderDescription"},props:{className:"bx-soa-customer-label"},text:this.params.MESS_ORDER_DESC}),d=BX.create("TEXTAREA",{props:{id:"orderDescription",cols:"4",className:"form-control bx-soa-customer-textarea bx-ios-fix",name:"ORDER_DESCRIPTION"}}),e=BX.create("DIV",{props:{className:"form-group bx-soa-customer-field"},children:[c,d]}),b.appendChild(e),a.appendChild(b)},editTotalBlock:function(){if(this.totalInfoBlockNode&&this.result.TOTAL){var a,b,c,d,e,f,g=this.result.TOTAL,h=g.ORDER_PRICE_FORMATED,i="Y"==this.params.SHOW_TOTAL_ORDER_BUTTON;if(BX.cleanNode(this.totalInfoBlockNode),this.options.showPriceWithoutDiscount&&(h+='<br /><span class="bx-price-old">'+g.PRICE_WITHOUT_DISCOUNT+"</span>"),this.totalInfoBlockNode.appendChild(this.createTotalUnit("Ð’Ð°Ñˆ Ð·Ð°ÐºÐ°Ð·",'<a href="/personal/cart/" class="bx-soa-editstep">Ð˜Ð·Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ</a>')),this.totalInfoBlockNode.appendChild(this.createTotalUnit(BX.message("SOA_SUM_SUMMARY"),h)),this.options.showOrderWeight&&this.totalInfoBlockNode.appendChild(this.createTotalUnit(BX.message("SOA_SUM_WEIGHT_SUM"),g.ORDER_WEIGHT_FORMATED)),this.options.showDiscountPrice&&(a=BX.message("SOA_SUM_DISCOUNT"),g.DISCOUNT_PERCENT_FORMATED&&parseFloat(g.DISCOUNT_PERCENT_FORMATED)>0&&(a+=g.DISCOUNT_PERCENT_FORMATED),this.totalInfoBlockNode.appendChild(this.createTotalUnit(a+":",g.DISCOUNT_PRICE_FORMATED))),this.options.showTaxList)for(c=0;c<g.TAX_LIST.length;c++)b=g.TAX_LIST[c].VALUE_MONEY_FORMATED||"",this.totalInfoBlockNode.appendChild(this.createTotalUnit(g.TAX_LIST[c].NAME,b));d=this.getSelectedDelivery(),e=d&&d.CALCULATE_ERRORS&&d.CALCULATE_ERRORS.length,f=e?BX.message("SOA_NOT_CALCULATED"):g.DELIVERY_PRICE_FORMATED,parseFloat(g.DELIVERY_PRICE)>=0&&this.result.DELIVERY.length&&this.totalInfoBlockNode.appendChild(this.createTotalUnit(BX.message("SOA_SUM_DELIVERY"),f,{error:e})),this.options.showPayedFromInnerBudget?(this.totalInfoBlockNode.appendChild(this.createTotalUnit(BX.message("SOA_SUM_IT"),g.ORDER_TOTAL_PRICE_FORMATED)),this.totalInfoBlockNode.appendChild(this.createTotalUnit(BX.message("SOA_SUM_PAYED"),g.PAYED_FROM_ACCOUNT_FORMATED)),this.totalInfoBlockNode.appendChild(this.createTotalUnit(BX.message("SOA_SUM_LEFT_TO_PAY"),g.ORDER_TOTAL_LEFT_TO_PAY_FORMATED,{total:!0}))):this.totalInfoBlockNode.appendChild(this.createTotalUnit(BX.message("SOA_SUM_IT"),g.ORDER_TOTAL_PRICE_FORMATED,{total:!0})),parseFloat(g.PAY_SYSTEM_PRICE)>=0&&this.result.DELIVERY.length&&this.totalInfoBlockNode.appendChild(this.createTotalUnit(BX.message("SOA_PAYSYSTEM_PRICE"),"~"+g.PAY_SYSTEM_PRICE_FORMATTED)),this.result.SHOW_AUTH||this.totalInfoBlockNode.appendChild(BX.create("DIV",{props:{className:"bx-soa-cart-total-button-container"+(i?"":" visible-xs")},children:[BX.create("A",{props:{href:"javascript:void(0)",className:"btn btn-default btn-size-L btn-order-save"},text:this.params.MESS_ORDER,events:{click:BX.proxy(this.clickOrderSaveAction,this)}})]})),this.editMobileTotalBlock()}},editMobileTotalBlock:function(){this.result.SHOW_AUTH?BX.removeClass(this.mobileTotalBlockNode,"visible-xs"):BX.addClass(this.mobileTotalBlockNode,"visible-xs"),BX.cleanNode(this.mobileTotalBlockNode),this.mobileTotalBlockNode.appendChild(this.totalInfoBlockNode.cloneNode(!0)),BX.bind(this.mobileTotalBlockNode.querySelector("a.bx-soa-price-not-calc"),"click",BX.proxy(function(){this.animateScrollTo(this.deliveryBlockNode)},this)),BX.bind(this.mobileTotalBlockNode.querySelector("a.btn-order-save"),"click",BX.proxy(this.clickOrderSaveAction,this))},createTotalUnit:function(a,b,c){var d;return a=a||"",b=b||"",c=c||{},d=c.error?[BX.create("A",{props:{className:"bx-soa-price-not-calc"},text:b,events:{click:BX.proxy(function(){this.animateScrollTo(this.deliveryBlockNode)},this)}})]:[b],BX.create("DIV",{props:{className:"bx-soa-cart-total-line"+(c.total?" bx-soa-cart-total-line-total":"")},children:[BX.create("SPAN",{props:{className:"bx-soa-cart-t"},text:a}),BX.create("SPAN",{props:{className:"bx-soa-cart-d"+(c.total&&this.options.totalPriceChanged?" bx-soa-changeCostSign":"")},children:d})]})},basketBlockScrollCheckEvent:function(a){var b=a.target||a.srcElement,c=b.scrollLeft,d=b.scrollWidth-(c+b.clientWidth),e=b.parentNode;0==c?BX.removeClass(e,"bx-soa-table-fade-left"):BX.addClass(e,"bx-soa-table-fade-left"),0==d?BX.removeClass(e,"bx-soa-table-fade-right"):BX.addClass(e,"bx-soa-table-fade-right")},basketBlockScrollCheck:function(){var a,b,c,d,e,f,g,h,i=this.orderBlockNode.querySelectorAll("div.bx-soa-table-fade"),j=!1;for(e=0;e<i.length;e++)a=i[e],c=a.querySelector("div.bx-soa-item-table"),b=a.clientWidth,d=c.clientWidth||0,j=j||d>b,j?(f=BX.firstChild(a),g=f.scrollLeft,h=f.scrollWidth-(g+f.clientWidth),0==g?BX.removeClass(a,"bx-soa-table-fade-left"):BX.addClass(a,"bx-soa-table-fade-left"),0==h?BX.removeClass(a,"bx-soa-table-fade-right"):BX.addClass(a,"bx-soa-table-fade-right"),0==g&&0==h&&BX.addClass(a,"bx-soa-table-fade-right")):BX.removeClass(a,"bx-soa-table-fade-left bx-soa-table-fade-right")},totalBlockScrollCheck:function(){if(this.totalInfoBlockNode&&this.totalGhostBlockNode){var a,b=BX.GetWindowScrollPos().scrollTop,c=BX.pos(this.totalGhostBlockNode).top,d=BX.pos(this.orderBlockNode).bottom;d-this.totalBlockNode.offsetHeight<b+20?BX.addClass(this.totalInfoBlockNode,"bx-soa-cart-total-bottom"):BX.removeClass(this.totalInfoBlockNode,"bx-soa-cart-total-bottom"),b>c&&!BX.hasClass(this.totalInfoBlockNode,"bx-soa-cart-total-fixed")?(a=this.totalInfoBlockNode.offsetWidth,BX.addClass(this.totalInfoBlockNode,"bx-soa-cart-total-fixed"),this.totalGhostBlockNode.style.paddingTop=this.totalInfoBlockNode.offsetHeight+"px",this.totalInfoBlockNode.style.width=a+"px"):b<c&&BX.hasClass(this.totalInfoBlockNode,"bx-soa-cart-total-fixed")&&(BX.removeClass(this.totalInfoBlockNode,"bx-soa-cart-total-fixed"),this.totalGhostBlockNode.style.paddingTop=0,this.totalInfoBlockNode.style.width="")}},totalBlockResizeCheck:function(){this.totalInfoBlockNode&&this.totalGhostBlockNode&&BX.hasClass(this.totalInfoBlockNode,"bx-soa-cart-total-fixed")&&(this.totalInfoBlockNode.style.width=this.totalGhostBlockNode.offsetWidth+"px")},totalBlockFixFont:function(){var a,b,c=this.totalInfoBlockNode.querySelector(".bx-soa-cart-total-line.bx-soa-cart-total-line-total"),d=[];c&&(b=BX.lastChild(c),d.push({node:b,maxFontSize:28,smallestValue:!1,scaleBy:b.parentNode})),"Y"==this.params.SHOW_TOTAL_ORDER_BUTTON&&(a=this.totalInfoBlockNode.querySelector(".bx-soa-cart-total-button-container"))&&(b=BX.lastChild(a),d.push({node:b,maxFontSize:18,smallestValue:!1})),d.length&&BX.FixFontSize.init({objList:d,onAdaptiveResize:!0})}},function(a){a&&!window.matchMedia("(max-width: 580px)").matches&&a(function(){document.getElementById("bx-soa-total")&&(setTimeout(function(){a(document).scroll()},0),a(document).scroll(function(){var b=a("#bx-soa-total .btn-order-save"),c=a("#bx-soa-orderSave .btn");c.offset().top+c.height()-a("#bx-soa-total .bx-soa-cart-total").offset().top<window.innerHeight?b.css({visibility:"hidden"}):b.css({visibility:"visible"})}))})}(window.jQuery)}();